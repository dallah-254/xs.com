<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XS Platform - Product Details</title>
    <link rel="stylesheet" href="header-footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* PRODUCT DETAILS PAGE SPECIFIC STYLES */
        
        /* Loading States */
        .loading-indicator {
            text-align: center;
            padding: 40px;
            color: var(--secondary-text);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #ffeaea;
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* Breadcrumb */
        .breadcrumb {
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .breadcrumb a {
            color: var(--accent-blue);
            text-decoration: none;
        }
        
        .breadcrumb a:hover {
            text-decoration: underline;
        }
        
        /* Product Details Container */
        .product-details-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }
        
        @media (min-width: 992px) {
            .product-details-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        /* Product Gallery */
        .product-gallery {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .main-image {
            background: var(--light-bg);
            border-radius: 12px;
            height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        
        .main-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        
        .main-image:hover img {
            transform: scale(1.05);
        }
        
        .main-image-placeholder {
            font-size: 120px;
            color: var(--accent-blue);
        }
        
        .thumbnail-gallery {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .thumbnail {
            width: 80px;
            height: 80px;
            background: var(--light-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid transparent;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        
        .thumbnail:hover {
            border-color: var(--accent-blue);
        }
        
        .thumbnail.active {
            border-color: var(--primary-blue);
        }
        
        .thumbnail img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
        }
        
        .thumbnail-placeholder {
            font-size: 24px;
            color: var(--border-color);
        }
        
        /* Product Info */
        .product-info {
            padding: 20px 0;
        }
        
        .product-header {
            margin-bottom: 20px;
        }
        
        .product-category {
            font-size: 0.9rem;
            color: var(--accent-blue);
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .product-title {
            font-size: 1.8rem;
            color: var(--primary-text);
            margin: 0 0 10px;
            line-height: 1.2;
        }
        
        .product-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stars {
            color: #ffc107;
        }
        
        .rating-count {
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .write-review {
            font-size: 0.9rem;
            color: var(--accent-blue);
            text-decoration: none;
            cursor: pointer;
        }
        
        .write-review:hover {
            text-decoration: underline;
        }
        
        .product-price-section {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--light-bg);
            border-radius: 12px;
        }
        
        .price-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .current-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .original-price {
            font-size: 1.2rem;
            color: var(--secondary-text);
            text-decoration: line-through;
        }
        
        .discount-badge {
            font-size: 0.9rem;
            color: #e74c3c;
            font-weight: 600;
            background: #ffeaea;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .stock-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .in-stock {
            color: #2ecc71;
        }
        
        .out-of-stock {
            color: #e74c3c;
        }
        
        .low-stock {
            color: #f39c12;
        }
        
        .product-description {
            margin-bottom: 30px;
            line-height: 1.6;
            color: var(--primary-text);
        }
        
        .product-description h4 {
            margin-bottom: 10px;
            color: var(--primary-text);
        }
        
        .product-features {
            list-style: none;
            padding: 0;
            margin: 15px 0;
        }
        
        .product-features li {
            padding: 5px 0;
            color: var(--secondary-text);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .product-features li i {
            color: var(--accent-blue);
        }
        
        /* Product Options */
        .product-options {
            margin-bottom: 30px;
        }
        
        .option-group {
            margin-bottom: 20px;
        }
        
        .option-label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary-text);
        }
        
        .option-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .option-btn {
            padding: 8px 16px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            background: white;
            color: var(--primary-text);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .option-btn:hover:not(.disabled) {
            border-color: var(--accent-blue);
        }
        
        .option-btn.active {
            border-color: var(--primary-blue);
            background: var(--primary-blue);
            color: white;
        }
        
        .option-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .quantity-label {
            font-weight: 600;
            color: var(--primary-text);
        }
        
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }
        
        .quantity-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: none;
            font-size: 1.2rem;
            color: var(--primary-text);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-btn:hover {
            background: var(--light-bg);
        }
        
        .quantity-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .quantity-input {
            width: 60px;
            height: 40px;
            border: none;
            text-align: center;
            font-size: 1rem;
            color: var(--primary-text);
        }
        
        .quantity-input:focus {
            outline: none;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn-primary {
            flex: 1;
            min-width: 200px;
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.2s;
        }
        
        .btn-primary:hover {
            background: var(--accent-blue);
        }
        
        .btn-primary.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-secondary {
            flex: 1;
            min-width: 200px;
            background: white;
            color: var(--primary-blue);
            border: 2px solid var(--primary-blue);
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: var(--light-bg);
        }
        
        .btn-secondary.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-wishlist {
            background: white;
            color: var(--primary-text);
            border: 2px solid var(--border-color);
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.2s;
        }
        
        .btn-wishlist:hover {
            border-color: #e74c3c;
            color: #e74c3c;
        }
        
        .btn-wishlist.active {
            border-color: #e74c3c;
            background: #ffeaea;
            color: #e74c3c;
        }
        
        /* Product Meta */
        .product-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--secondary-text);
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Tabs */
        .product-tabs {
            margin-bottom: 50px;
        }
        
        .tab-headers {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
            overflow-x: auto;
        }
        
        .tab-header {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            color: var(--secondary-text);
            cursor: pointer;
            position: relative;
            white-space: nowrap;
        }
        
        .tab-header:hover {
            color: var(--primary-text);
        }
        
        .tab-header.active {
            color: var(--primary-blue);
        }
        
        .tab-header.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-blue);
            border-radius: 3px 3px 0 0;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Specifications */
        .specs-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .specs-table tr {
            border-bottom: 1px solid var(--border-color);
        }
        
        .specs-table td {
            padding: 15px;
        }
        
        .specs-table td:first-child {
            font-weight: 600;
            color: var(--primary-text);
            width: 30%;
        }
        
        .specs-table td:last-child {
            color: var(--secondary-text);
        }
        
        /* Reviews */
        .reviews-summary {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--light-bg);
            border-radius: 12px;
            flex-wrap: wrap;
        }
        
        .average-rating {
            text-align: center;
        }
        
        .rating-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
        }
        
        .rating-stars {
            margin: 5px 0;
        }
        
        .total-reviews {
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .rating-bars {
            flex: 1;
            min-width: 250px;
        }
        
        .rating-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .bar-label {
            width: 60px;
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .bar-container {
            flex: 1;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .bar-fill {
            height: 100%;
            background: #ffc107;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .bar-count {
            width: 40px;
            font-size: 0.9rem;
            color: var(--secondary-text);
            text-align: right;
        }
        
        .review-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .review-item {
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .reviewer-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .reviewer-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
        }
        
        .reviewer-name {
            font-weight: 600;
            color: var(--primary-text);
        }
        
        .review-date {
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .review-content {
            color: var(--primary-text);
            line-height: 1.6;
        }
        
        .review-helpful {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: var(--secondary-text);
        }
        
        .helpful-btn {
            background: none;
            border: none;
            color: var(--accent-blue);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .helpful-btn:hover {
            text-decoration: underline;
        }
        
        /* Review Form */
        .review-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .review-form h3 {
            margin: 0 0 20px;
            color: var(--primary-text);
        }
        
        .rating-input {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            margin-bottom: 20px;
        }
        
        .rating-input input {
            display: none;
        }
        
        .rating-input label {
            font-size: 24px;
            color: var(--border-color);
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .rating-input input:checked ~ label,
        .rating-input label:hover,
        .rating-input label:hover ~ label {
            color: #ffc107;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-text);
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            color: var(--primary-text);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-blue);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        /* Related Products */
        .related-products {
            margin-bottom: 50px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-title {
            font-size: 1.5rem;
            color: var(--primary-text);
            margin: 0;
        }
        
        .section-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .section-link:hover {
            text-decoration: underline;
        }
        
        .products-slider {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            text-decoration: none;
            color: inherit;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .product-card .product-image {
            height: 200px;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .product-card .product-info {
            padding: 20px;
        }
        
        .product-card .product-title {
            font-size: 1rem;
            margin: 0 0 10px;
            color: var(--primary-text);
        }
        
        .product-card .product-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .main-image {
                height: 300px;
            }
            
            .product-title {
                font-size: 1.5rem;
            }
            
            .current-price {
                font-size: 1.5rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-primary, .btn-secondary, .btn-wishlist {
                width: 100%;
            }
            
            .reviews-summary {
                flex-direction: column;
                text-align: center;
            }
            
            .rating-bars {
                width: 100%;
            }
            
            .review-form {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
<!-- Customized Header - Matches Products Page -->
<header class="main-header">
    <div class="header-top-row">
        <div class="logo-and-nav">
            <div class="logo">XS</div>
            <div class="slogan">Premium Electronics Store</div>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="products.html" class="nav-link active">Products</a> 
                <a href="services.html" class="nav-link">Services</a>
                <a href="deals.html" class="nav-link">Deals</a>
                <a href="support.html" class="nav-link">Support</a>
            </nav>
        </div>

        <div class="search-and-actions">
            <div class="search-bar-top">
                <i class="fas fa-search"></i>
                <input type="text" id="global-search" placeholder="Search products..." class="search-input">
            </div>

            <!-- Desktop Auth State -->
            <div class="auth-state">
                <!-- Logged Out State (default) -->
                <div class="logged-out-state" id="logged-out-state">
                    <a href="login.html" class="auth-link login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log in
                    </a>
                </div>
                
                <!-- Logged In State -->
                <div class="logged-in-state" id="logged-in-state" style="display: none;">
                    <div class="user-profile">
                        <button class="user-menu-btn" id="user-menu-btn" aria-label="Open account menu">
                            <i class="fas fa-user-circle"></i>
                        </button>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="user-dashboard.html" class="dropdown-item">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                            <a href="profile.html" class="dropdown-item">
                                <i class="fas fa-user"></i> My Profile
                            </a>
                            <a href="orders.html" class="dropdown-item">
                                <i class="fas fa-box"></i> My Orders
                            </a>
                            <a href="wishlist.html" class="dropdown-item">
                                <i class="fas fa-heart"></i> Wishlist
                            </a>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item logout-btn" id="logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn-wishlist" id="wishlist-btn">
                <i class="fas fa-heart"></i> 
                <span class="wishlist-count">0</span>
            </button>
            
            <button class="btn-submit" id="cart-btn"><i class="fas fa-shopping-cart"></i> Cart <span class="cart-count">0</span></button>
            
            <!-- Mobile Search Icon -->
            <button class="mobile-search-btn" id="mobile-search-btn">
                <i class="fas fa-search"></i>
            </button>
            
            <!-- Mobile Hamburger Menu -->
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Search Bar (Hidden by default) -->
    <div class="mobile-search-bar" id="mobile-search-bar">
        <div class="mobile-search-container">
            <input type="text" placeholder="Search..." class="mobile-search-input">
            <button class="mobile-search-close" id="mobile-search-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Panel (Hidden by default) -->
    <div class="mobile-menu-panel" id="mobile-menu-panel">
        <div class="mobile-menu-header">
            <div class="mobile-logo">XS</div>
            <button class="mobile-menu-close" id="mobile-menu-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="mobile-menu-content">
            <!-- Mobile Auth State -->
            <div class="mobile-auth-state">
                <!-- Mobile Logged Out State -->
                <div class="mobile-logged-out-state" id="mobile-logged-out-state">
                    <a href="login.html" class="mobile-auth-link login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log in
                    </a>
                </div>
                
                <!-- Mobile Logged In State -->
                <div class="mobile-logged-in-state" id="mobile-logged-in-state" style="display: none;">
                    <div class="mobile-user-info">
                        <div class="mobile-user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="mobile-user-details">
                            <div class="mobile-user-name" id="mobile-user-name">Welcome!</div>
                            <div class="mobile-user-email" id="mobile-user-email">user@example.com</div>
                        </div>
                    </div>
                    
                    <div class="mobile-user-menu">
                        <a href="user-dashboard.html" class="mobile-nav-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="profile.html" class="mobile-nav-link">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a href="orders.html" class="mobile-nav-link">
                            <i class="fas fa-box"></i> My Orders
                        </a>
                        <a href="wishlist.html" class="mobile-nav-link">
                            <i class="fas fa-heart"></i> Wishlist
                        </a>
                        <div class="mobile-menu-divider"></div>
                        <button class="mobile-action-btn" id="mobile-logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mobile-nav-section">
                <a href="index.html" class="mobile-nav-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="products.html" class="mobile-nav-link active">
                    <i class="fas fa-shopping-bag"></i> Products
                </a>
                <a href="services.html" class="mobile-nav-link">
                    <i class="fas fa-tools"></i> Services
                </a>
                <a href="deals.html" class="mobile-nav-link">
                    <i class="fas fa-tag"></i> Deals
                </a>
                <a href="support.html" class="mobile-nav-link">
                    <i class="fas fa-headset"></i> Support
                </a>
            </div>
            
            <div class="mobile-actions-section">
                <button class="mobile-action-btn" id="mobile-wishlist-btn">
                    <i class="fas fa-heart"></i> Wishlist <span class="mobile-wishlist-count">0</span>
                </button>
                <button class="mobile-action-btn" id="mobile-cart-btn">
                    <i class="fas fa-shopping-cart"></i> Cart <span class="mobile-cart-count">0</span>
                </button>
            </div>
        </div>
    </div>
</header>

<main class="main-content">
    <!-- Loading State -->
    <div class="loading-indicator" id="loading-indicator">
        <div class="loading-spinner"></div>
        <p>Loading product details...</p>
    </div>
    
    <!-- Error State -->
    <div class="error-message" id="error-message" style="display: none;">
        <p id="error-text">Error loading product details. Please try again later.</p>
        <button class="btn-pro" id="retry-load-btn">Retry</button>
    </div>
    
    <!-- Product Details Container (Initially Hidden) -->
    <div id="product-details-content" style="display: none;">
        <!-- Breadcrumb -->
        <div class="breadcrumb" id="breadcrumb">
            <a href="index.html">Home</a> &gt;
            <a href="products.html">Products</a> &gt;
            <span id="breadcrumb-category">Loading...</span> &gt;
            <span id="breadcrumb-product">Loading...</span>
        </div>
        
        <!-- Product Details -->
        <div class="product-details-container">
            <!-- Product Gallery -->
            <div class="product-gallery">
                <div class="main-image" id="main-image">
                    <i class="fas fa-box main-image-placeholder"></i>
                </div>
                <div class="thumbnail-gallery" id="thumbnail-gallery">
                    <!-- Thumbnails will be dynamically populated -->
                </div>
            </div>
            
            <!-- Product Info -->
            <div class="product-info">
                <div class="product-header">
                    <div class="product-category" id="product-category">Loading...</div>
                    <h1 class="product-title" id="product-title">Loading...</h1>
                    <div class="product-rating">
                        <div class="stars" id="product-rating-stars">
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <div class="rating-count" id="rating-count">(0 reviews)</div>
                        <span class="write-review" id="write-review-btn">Write a review</span>
                    </div>
                </div>
                
                <div class="product-price-section">
                    <div class="price-row">
                        <div class="current-price" id="current-price">$0.00</div>
                        <div class="original-price" id="original-price" style="display: none;"></div>
                        <div class="discount-badge" id="discount-badge" style="display: none;"></div>
                    </div>
                    <div class="stock-status">
                        <i class="fas fa-check-circle in-stock" id="stock-icon"></i>
                        <span id="stock-status-text">Checking stock...</span>
                    </div>
                </div>
                
                <div class="product-description" id="product-description">
                    <h4>Description</h4>
                    <p id="description-text">Loading description...</p>
                    
                    <ul class="product-features" id="product-features">
                        <!-- Features will be dynamically populated -->
                    </ul>
                </div>
                
                <!-- Product Options -->
                <div class="product-options" id="product-options">
                    <!-- Options will be dynamically populated -->
                </div>
                
                <!-- Quantity Selector -->
                <div class="quantity-selector">
                    <div class="quantity-label">Quantity:</div>
                    <div class="quantity-controls">
                        <button class="quantity-btn" id="decrease-qty">-</button>
                        <input type="number" class="quantity-input" id="quantity" value="1" min="1" max="10">
                        <button class="quantity-btn" id="increase-qty">+</button>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="btn-primary" id="add-to-cart-btn">
                        <i class="fas fa-shopping-cart"></i> Add to Cart
                    </button>
                    <button class="btn-secondary" id="buy-now-btn">
                        <i class="fas fa-bolt"></i> Buy Now
                    </button>
                    <button class="btn-wishlist" id="wishlist-toggle">
                        <i class="far fa-heart"></i> Add to Wishlist
                    </button>
                </div>
                
                <!-- Product Meta -->
                <div class="product-meta">
                    <div class="meta-item">
                        <i class="fas fa-shipping-fast"></i>
                        <span id="shipping-info">Free shipping on orders over $100</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-shield-alt"></i>
                        <span id="warranty-info">1-year warranty included</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-undo"></i>
                        <span id="return-info">30-day return policy</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Product Tabs -->
        <div class="product-tabs">
            <div class="tab-headers">
                <button class="tab-header active" data-tab="description">Description</button>
                <button class="tab-header" data-tab="specifications">Specifications</button>
                <button class="tab-header" data-tab="reviews">Reviews (<span id="reviews-count">0</span>)</button>
                <button class="tab-header" data-tab="shipping">Shipping & Returns</button>
            </div>
            
            <!-- Description Tab -->
            <div class="tab-content active" id="tab-description">
                <div class="product-description" id="detailed-description">
                    <!-- Detailed description will be loaded here -->
                </div>
            </div>
            
            <!-- Specifications Tab -->
            <div class="tab-content" id="tab-specifications">
                <table class="specs-table" id="specs-table">
                    <!-- Specifications will be dynamically populated -->
                </table>
            </div>
            
            <!-- Reviews Tab -->
            <div class="tab-content" id="tab-reviews">
                <!-- Reviews Summary -->
                <div class="reviews-summary">
                    <div class="average-rating">
                        <div class="rating-number" id="average-rating">0.0</div>
                        <div class="rating-stars" id="average-rating-stars">
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                            <i class="far fa-star"></i>
                        </div>
                        <div class="total-reviews" id="total-reviews">0 reviews</div>
                    </div>
                    
                    <div class="rating-bars" id="rating-bars">
                        <!-- Rating bars will be dynamically populated -->
                    </div>
                </div>
                
                <!-- Review Form (Initially Hidden) -->
                <div class="review-form" id="review-form" style="display: none;">
                    <h3>Write Your Review</h3>
                    <div class="rating-input">
                        <input type="radio" id="star5" name="rating" value="5">
                        <label for="star5"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star4" name="rating" value="4">
                        <label for="star4"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star3" name="rating" value="3">
                        <label for="star3"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star2" name="rating" value="2">
                        <label for="star2"><i class="fas fa-star"></i></label>
                        <input type="radio" id="star1" name="rating" value="1">
                        <label for="star1"><i class="fas fa-star"></i></label>
                    </div>
                    
                    <div class="form-group">
                        <label for="review-title">Review Title</label>
                        <input type="text" class="form-control" id="review-title" placeholder="Summarize your experience">
                    </div>
                    
                    <div class="form-group">
                        <label for="review-content">Your Review</label>
                        <textarea class="form-control" id="review-content" placeholder="Share your thoughts about this product..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="reviewer-name">Your Name</label>
                        <input type="text" class="form-control" id="reviewer-name" placeholder="Enter your name">
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-primary" id="submit-review-btn">
                            <i class="fas fa-paper-plane"></i> Submit Review
                        </button>
                        <button class="btn-secondary" id="cancel-review-btn">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    </div>
                </div>
                
                <!-- Reviews List -->
                <div class="review-list" id="review-list">
                    <!-- Reviews will be dynamically populated -->
                </div>
                
                <!-- Load More Reviews Button -->
                <div style="text-align: center; margin-top: 30px;" id="reviews-controls">
                    <button class="btn-secondary" id="load-more-reviews">
                        <i class="fas fa-comments"></i> Load More Reviews
                    </button>
                    <button class="btn-primary" id="show-review-form-btn" style="margin-left: 15px;">
                        <i class="fas fa-edit"></i> Write a Review
                    </button>
                </div>
            </div>
            
            <!-- Shipping Tab -->
            <div class="tab-content" id="tab-shipping">
                <div class="product-description" id="shipping-info-content">
                    <!-- Shipping info will be dynamically populated -->
                </div>
            </div>
        </div>
        
        <!-- Related Products -->
        <div class="related-products">
            <div class="section-header">
                <h2 class="section-title">You Might Also Like</h2>
                <a href="products.html" class="section-link">
                    View All Products <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            
            <div class="products-slider" id="related-products">
                <!-- Related products will be dynamically populated -->
            </div>
        </div>
    </div>
</main>

<footer class="main-footer">
    <div class="footer-content">
        <div class="footer-section">
            <h4>XS Platform</h4>
            <p>Your trusted source for electronics and repair services since 2024.</p>
        </div>
        
        <div class="footer-section">
            <h4>Shop</h4>
            <ul class="footer-links">
                <li><a href="products.html">All Products</a></li>
                <li><a href="products.html?category=new">New Arrivals</a></li>
                <li><a href="products.html?category=bestsellers">Best Sellers</a></li>
                <li><a href="deals.html">Deals & Discounts</a></li>
                <li><a href="services.html">Repair Services</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Customer Service</h4>
            <ul class="footer-links">
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="support.html">Support Center</a></li>
                <li><a href="faq.html">FAQ</a></li>
                <li><a href="shipping.html">Shipping Info</a></li>
                <li><a href="returns.html">Returns & Exchanges</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Account</h4>
            <ul class="footer-links">
                <li><a href="login.html">Sign In</a></li>
                <li><a href="register.html">Create Account</a></li>
                <li><a href="user-dashboard.html">My Dashboard</a></li>
                <li><a href="orders.html">Order History</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Legal</h4>
            <ul class="footer-links">
                <li><a href="privacy-policy.html">Privacy Policy</a></li>
                <li><a href="terms.html">Terms of Service</a></li>
                <li><a href="cookies.html">Cookie Policy</a></li>
            </ul>
        </div>
    </div>
    
    <div class="copyright">
        &copy; 2024 XS Platform. All rights reserved.
    </div>
</footer>

<!-- Link to shared JavaScript file -->
<script src="header-footer.js"></script>

<!-- Product details page specific JavaScript with API Integration -->
<script>
    // API Configuration
    const API_BASE_URL = 'https://api.xsplatform.com'; // Replace with your actual API base URL
    const API_ENDPOINTS = {
        // Product Endpoints
        PRODUCT_DETAIL: `${API_BASE_URL}/api/v1/products/{id}`,
        PRODUCT_VARIANTS: `${API_BASE_URL}/api/v1/products/{id}/variants`,
        PRODUCT_OPTIONS: `${API_BASE_URL}/api/v1/products/{id}/options`,
        
        // Review Endpoints
        PRODUCT_REVIEWS: `${API_BASE_URL}/api/v1/products/{id}/reviews`,
        REVIEW_DETAIL: `${API_BASE_URL}/api/v1/reviews/{id}`,
        SUBMIT_REVIEW: `${API_BASE_URL}/api/v1/reviews`,
        UPDATE_REVIEW: `${API_BASE_URL}/api/v1/reviews/{id}`,
        DELETE_REVIEW: `${API_BASE_URL}/api/v1/reviews/{id}`,
        REVIEW_HELPFUL: `${API_BASE_URL}/api/v1/reviews/{id}/helpful`,
        
        // Related Products
        RELATED_PRODUCTS: `${API_BASE_URL}/api/v1/products/{id}/related`,
        
        // Wishlist Endpoints
        WISHLIST: `${API_BASE_URL}/api/v1/wishlist`,
        WISHLIST_ITEM: `${API_BASE_URL}/api/v1/wishlist/{id}`,
        CHECK_WISHLIST: `${API_BASE_URL}/api/v1/wishlist/check/{id}`,
        
        // Cart Endpoints
        CART: `${API_BASE_URL}/api/v1/cart`,
        CART_ITEM: `${API_BASE_URL}/api/v1/cart/{id}`,
        
        // Order Endpoints
        CREATE_ORDER: `${API_BASE_URL}/api/v1/orders`,
        QUICK_ORDER: `${API_BASE_URL}/api/v1/orders/quick`,
        
        // Inventory Endpoints
        CHECK_STOCK: `${API_BASE_URL}/api/v1/inventory/{id}`,
        STOCK_LEVELS: `${API_BASE_URL}/api/v1/inventory/{id}/levels`,
        
        // Shipping Endpoints
        SHIPPING_INFO: `${API_BASE_URL}/api/v1/shipping/products/{id}`,
        CALCULATE_SHIPPING: `${API_BASE_URL}/api/v1/shipping/calculate`,
        
        // Analytics Endpoints
        PRODUCT_VIEW: `${API_BASE_URL}/api/v1/analytics/products/{id}/view`,
        RECOMMENDATIONS: `${API_BASE_URL}/api/v1/recommendations/products/{id}`,
        
        // User Endpoints
        USER_PROFILE: `${API_BASE_URL}/api/v1/user/profile`,
        USER_REVIEWS: `${API_BASE_URL}/api/v1/user/reviews`,
        
        // Search Endpoints
        SEARCH_PRODUCTS: `${API_BASE_URL}/api/v1/search/products`,
        
        // Comparison Endpoints
        COMPARE_PRODUCTS: `${API_BASE_URL}/api/v1/compare`,
        
        // Price Alert Endpoints
        PRICE_ALERTS: `${API_BASE_URL}/api/v1/price-alerts`,
        CREATE_PRICE_ALERT: `${API_BASE_URL}/api/v1/price-alerts/products/{id}`,
        
        // Question & Answer Endpoints
        PRODUCT_QUESTIONS: `${API_BASE_URL}/api/v1/products/{id}/questions`,
        SUBMIT_QUESTION: `${API_BASE_URL}/api/v1/questions`,
        ANSWER_QUESTION: `${API_BASE_URL}/api/v1/questions/{id}/answer`
    };

    // Current State
    let currentProduct = null;
    let currentVariant = null;
    let productId = null;
    let wishlistItems = [];
    let cartCount = 0;
    let reviews = [];
    let currentReviewsPage = 1;
    let reviewsPerPage = 5;
    let totalReviews = 0;
    let isInWishlist = false;
    let selectedOptions = {};

    // Get product ID from URL
    function getProductIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('id') || '1'; // Default to ID 1 if not specified
    }

    // API Helper Functions
    async function fetchAPI(url, options = {}) {
        try {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getAuthToken()}`
                },
                ...options
            };
            
            const response = await fetch(url, defaultOptions);
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API Fetch Error:', error);
            throw error;
        }
    }

    function getAuthToken() {
        return localStorage.getItem('xs_auth_token') || '';
    }

    function isUserLoggedIn() {
        return !!getAuthToken();
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Product details page initialized');
        
        // Get product ID from URL
        productId = getProductIdFromUrl();
        
        // Load product data
        loadProductData();
        
        // Initialize event listeners
        initEventListeners();
        
        // Initialize search
        initSearch();
    });

    // Load product data
    async function loadProductData() {
        try {
            showLoading();
            
            // Load product details
            const productUrl = API_ENDPOINTS.PRODUCT_DETAIL.replace('{id}', productId);
            const productData = await fetchAPI(productUrl);
            currentProduct = productData;
            
            // Track product view for analytics
            trackProductView();
            
            // Load product variants if available
            if (productData.hasVariants) {
                await loadProductVariants();
            }
            
            // Load product options
            await loadProductOptions();
            
            // Load reviews
            await loadReviews();
            
            // Load related products
            await loadRelatedProducts();
            
            // Check wishlist status
            await checkWishlistStatus();
            
            // Check stock status
            await checkStockStatus();
            
            // Update UI
            updateProductUI();
            hideLoading();
            showContent();
            
        } catch (error) {
            console.error('Failed to load product data:', error);
            hideLoading();
            showError('Failed to load product details. Please try again.');
        }
    }

    // Track product view for analytics
    async function trackProductView() {
        try {
            const url = API_ENDPOINTS.PRODUCT_VIEW.replace('{id}', productId);
            await fetchAPI(url, { method: 'POST' });
        } catch (error) {
            console.error('Failed to track product view:', error);
        }
    }

    // Load product variants
    async function loadProductVariants() {
        try {
            const url = API_ENDPOINTS.PRODUCT_VARIANTS.replace('{id}', productId);
            const variantsData = await fetchAPI(url);
            
            // Set default variant
            if (variantsData.variants && variantsData.variants.length > 0) {
                currentVariant = variantsData.variants[0];
            }
        } catch (error) {
            console.error('Failed to load product variants:', error);
        }
    }

    // Load product options
    async function loadProductOptions() {
        try {
            const url = API_ENDPOINTS.PRODUCT_OPTIONS.replace('{id}', productId);
            const optionsData = await fetchAPI(url);
            
            // Store options for later use
            if (optionsData.options) {
                selectedOptions = {};
                optionsData.options.forEach(option => {
                    if (option.values && option.values.length > 0) {
                        selectedOptions[option.name] = option.values[0].value;
                    }
                });
            }
        } catch (error) {
            console.error('Failed to load product options:', error);
        }
    }

    // Load reviews
    async function loadReviews() {
        try {
            const url = `${API_ENDPOINTS.PRODUCT_REVIEWS.replace('{id}', productId)}?page=${currentReviewsPage}&limit=${reviewsPerPage}`;
            const reviewsData = await fetchAPI(url);
            
            reviews = reviewsData.reviews || [];
            totalReviews = reviewsData.total || 0;
            
        } catch (error) {
            console.error('Failed to load reviews:', error);
        }
    }

    // Load related products
    async function loadRelatedProducts() {
        try {
            const url = API_ENDPOINTS.RELATED_PRODUCTS.replace('{id}', productId);
            const relatedData = await fetchAPI(url);
            
            // Store related products
            if (relatedData.products) {
                // Update UI with related products
                renderRelatedProducts(relatedData.products.slice(0, 4)); // Show first 4
            }
        } catch (error) {
            console.error('Failed to load related products:', error);
        }
    }

    // Check wishlist status
    async function checkWishlistStatus() {
        if (!isUserLoggedIn()) return;
        
        try {
            const url = API_ENDPOINTS.CHECK_WISHLIST.replace('{id}', productId);
            const wishlistData = await fetchAPI(url);
            isInWishlist = wishlistData.inWishlist || false;
        } catch (error) {
            console.error('Failed to check wishlist status:', error);
        }
    }

    // Check stock status
    async function checkStockStatus() {
        try {
            const url = API_ENDPOINTS.CHECK_STOCK.replace('{id}', productId);
            const stockData = await fetchAPI(url);
            
            // Update stock status in UI
            updateStockStatus(stockData);
        } catch (error) {
            console.error('Failed to check stock status:', error);
        }
    }

    // Update product UI
    function updateProductUI() {
        if (!currentProduct) return;
        
        // Update breadcrumb
        updateBreadcrumb();
        
        // Update product gallery
        updateProductGallery();
        
        // Update product info
        updateProductInfo();
        
        // Update product options
        updateProductOptions();
        
        // Update reviews tab
        updateReviewsUI();
        
        // Update specifications
        updateSpecifications();
        
        // Update shipping info
        updateShippingInfo();
    }

    // Update breadcrumb
    function updateBreadcrumb() {
        document.getElementById('breadcrumb-category').textContent = currentProduct.category || 'Electronics';
        document.getElementById('breadcrumb-product').textContent = currentProduct.name;
    }

    // Update product gallery
    function updateProductGallery() {
        const mainImage = document.getElementById('main-image');
        const thumbnailGallery = document.getElementById('thumbnail-gallery');
        
        // Clear existing thumbnails
        thumbnailGallery.innerHTML = '';
        
        // Add main image
        if (currentProduct.images && currentProduct.images.length > 0) {
            mainImage.innerHTML = `<img src="${currentProduct.images[0]}" alt="${currentProduct.name}" loading="lazy">`;
            
            // Add thumbnails
            currentProduct.images.forEach((image, index) => {
                const thumbnail = document.createElement('div');
                thumbnail.className = `thumbnail ${index === 0 ? 'active' : ''}`;
                thumbnail.dataset.image = image;
                thumbnail.innerHTML = `<img src="${image}" alt="${currentProduct.name} - Image ${index + 1}">`;
                
                thumbnail.addEventListener('click', () => {
                    // Update main image
                    mainImage.innerHTML = `<img src="${image}" alt="${currentProduct.name}">`;
                    
                    // Update active thumbnail
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    thumbnail.classList.add('active');
                });
                
                thumbnailGallery.appendChild(thumbnail);
            });
        } else {
            // Use placeholder
            const iconClass = getProductIcon(currentProduct.category);
            mainImage.innerHTML = `<i class="fas ${iconClass} main-image-placeholder"></i>`;
            
            // Add placeholder thumbnails
            for (let i = 0; i < 3; i++) {
                const thumbnail = document.createElement('div');
                thumbnail.className = `thumbnail ${i === 0 ? 'active' : ''}`;
                thumbnail.dataset.image = 'placeholder';
                thumbnail.innerHTML = `<i class="fas ${iconClass} thumbnail-placeholder"></i>`;
                thumbnailGallery.appendChild(thumbnail);
            }
        }
    }

    // Get product icon based on category
    function getProductIcon(category) {
        const iconMap = {
            'phones': 'fa-mobile-alt',
            'computers': 'fa-laptop',
            'audio': 'fa-headphones',
            'electronics': 'fa-tv',
            'accessories': 'fa-keyboard',
            'tablets': 'fa-tablet-alt',
            'wearables': 'fa-clock',
            'default': 'fa-box'
        };
        
        const normalizedCategory = (category || '').toLowerCase();
        return iconMap[normalizedCategory] || iconMap.default;
    }

    // Update product info
    function updateProductInfo() {
        // Basic info
        document.getElementById('product-category').textContent = currentProduct.category || 'Electronics';
        document.getElementById('product-title').textContent = currentProduct.name;
        document.getElementById('description-text').textContent = currentProduct.description || 'No description available.';
        
        // Price
        const currentPrice = currentVariant?.price || currentProduct.price || 0;
        const originalPrice = currentVariant?.originalPrice || currentProduct.originalPrice;
        
        document.getElementById('current-price').textContent = `$${currentPrice.toFixed(2)}`;
        
        if (originalPrice && originalPrice > currentPrice) {
            const discount = Math.round((1 - currentPrice / originalPrice) * 100);
            document.getElementById('original-price').textContent = `$${originalPrice.toFixed(2)}`;
            document.getElementById('original-price').style.display = 'block';
            document.getElementById('discount-badge').textContent = `Save ${discount}%`;
            document.getElementById('discount-badge').style.display = 'inline-block';
        }
        
        // Rating
        const rating = currentProduct.rating || 0;
        updateRatingStars('product-rating-stars', rating);
        document.getElementById('rating-count').textContent = `(${currentProduct.reviewCount || 0} reviews)`;
        
        // Features
        updateProductFeatures();
        
        // Wishlist button
        updateWishlistButton();
    }

    // Update rating stars
    function updateRatingStars(elementId, rating) {
        const element = document.getElementById(elementId);
        if (!element) return;
        
        let starsHtml = '';
        const fullStars = Math.floor(rating);
        const hasHalfStar = rating % 1 >= 0.5;
        
        // Full stars
        for (let i = 0; i < fullStars; i++) {
            starsHtml += '<i class="fas fa-star"></i>';
        }
        
        // Half star
        if (hasHalfStar) {
            starsHtml += '<i class="fas fa-star-half-alt"></i>';
        }
        
        // Empty stars
        const remaining = 5 - fullStars - (hasHalfStar ? 1 : 0);
        for (let i = 0; i < remaining; i++) {
            starsHtml += '<i class="far fa-star"></i>';
        }
        
        element.innerHTML = starsHtml;
    }

    // Update product features
    function updateProductFeatures() {
        const featuresList = document.getElementById('product-features');
        featuresList.innerHTML = '';
        
        if (currentProduct.features && currentProduct.features.length > 0) {
            currentProduct.features.forEach(feature => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-check"></i> ${feature}`;
                featuresList.appendChild(li);
            });
        }
    }

    // Update product options
    function updateProductOptions() {
        const optionsContainer = document.getElementById('product-options');
        
        if (!currentProduct.options || currentProduct.options.length === 0) {
            optionsContainer.style.display = 'none';
            return;
        }
        
        optionsContainer.style.display = 'block';
        optionsContainer.innerHTML = '';
        
        currentProduct.options.forEach(option => {
            const optionGroup = document.createElement('div');
            optionGroup.className = 'option-group';
            
            const label = document.createElement('label');
            label.className = 'option-label';
            label.textContent = option.name;
            
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'option-buttons';
            
            option.values.forEach((value, index) => {
                const button = document.createElement('button');
                button.className = `option-btn ${index === 0 ? 'active' : ''}`;
                button.dataset.option = option.name;
                button.dataset.value = value.value;
                button.textContent = value.label;
                
                if (value.outOfStock) {
                    button.classList.add('disabled');
                    button.title = 'Out of stock';
                }
                
                button.addEventListener('click', () => {
                    if (button.classList.contains('disabled')) return;
                    
                    // Remove active class from all buttons in group
                    buttonsContainer.querySelectorAll('.option-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    button.classList.add('active');
                    
                    // Update selected options
                    selectedOptions[option.name] = value.value;
                    
                    // Check if variant combination is available
                    checkVariantAvailability();
                });
                
                buttonsContainer.appendChild(button);
            });
            
            optionGroup.appendChild(label);
            optionGroup.appendChild(buttonsContainer);
            optionsContainer.appendChild(optionGroup);
        });
    }

    // Check variant availability
    async function checkVariantAvailability() {
        try {
            const variantId = await findVariantId();
            if (variantId) {
                await loadVariantDetails(variantId);
            }
        } catch (error) {
            console.error('Failed to check variant availability:', error);
        }
    }

    // Find variant ID based on selected options
    async function findVariantId() {
        // This would call an API endpoint to find the variant ID
        // For now, return null (simulating API call)
        return null;
    }

    // Load variant details
    async function loadVariantDetails(variantId) {
        try {
            // Update current variant and UI
            // This would call an API endpoint to get variant details
            console.log('Loading variant details for:', variantId);
        } catch (error) {
            console.error('Failed to load variant details:', error);
        }
    }

    // Update stock status
    function updateStockStatus(stockData) {
        const stockIcon = document.getElementById('stock-icon');
        const stockText = document.getElementById('stock-status-text');
        
        if (stockData.inStock) {
            stockIcon.className = 'fas fa-check-circle in-stock';
            stockText.textContent = 'In Stock';
            stockText.className = 'in-stock';
            
            // Enable buttons
            document.getElementById('add-to-cart-btn').classList.remove('disabled');
            document.getElementById('buy-now-btn').classList.remove('disabled');
            
            if (stockData.quantity <= 10) {
                stockText.textContent = `Only ${stockData.quantity} left in stock`;
                stockIcon.className = 'fas fa-exclamation-circle low-stock';
                stockText.className = 'low-stock';
            }
        } else {
            stockIcon.className = 'fas fa-times-circle out-of-stock';
            stockText.textContent = 'Out of Stock';
            stockText.className = 'out-of-stock';
            
            // Disable buttons
            document.getElementById('add-to-cart-btn').classList.add('disabled');
            document.getElementById('buy-now-btn').classList.add('disabled');
        }
    }

    // Update wishlist button
    function updateWishlistButton() {
        const wishlistBtn = document.getElementById('wishlist-toggle');
        
        if (isInWishlist) {
            wishlistBtn.innerHTML = '<i class="fas fa-heart"></i> Remove from Wishlist';
            wishlistBtn.classList.add('active');
        } else {
            wishlistBtn.innerHTML = '<i class="far fa-heart"></i> Add to Wishlist';
            wishlistBtn.classList.remove('active');
        }
    }

    // Update reviews UI
    function updateReviewsUI() {
        // Update reviews count
        document.getElementById('reviews-count').textContent = totalReviews;
        document.getElementById('total-reviews').textContent = `${totalReviews} reviews`;
        
        // Update average rating
        const avgRating = currentProduct.rating || 0;
        document.getElementById('average-rating').textContent = avgRating.toFixed(1);
        updateRatingStars('average-rating-stars', avgRating);
        
        // Update rating bars
        updateRatingBars();
        
        // Render reviews
        renderReviews();
    }

    // Update rating bars
    function updateRatingBars() {
        const ratingBars = document.getElementById('rating-bars');
        ratingBars.innerHTML = '';
        
        // This would come from API
        const ratingDistribution = {
            5: 75,
            4: 15,
            3: 5,
            2: 3,
            1: 2
        };
        
        for (let i = 5; i >= 1; i--) {
            const percentage = ratingDistribution[i] || 0;
            const count = Math.round((percentage / 100) * totalReviews);
            
            const ratingBar = document.createElement('div');
            ratingBar.className = 'rating-bar';
            
            ratingBar.innerHTML = `
                <div class="bar-label">${i} stars</div>
                <div class="bar-container">
                    <div class="bar-fill" style="width: ${percentage}%;"></div>
                </div>
                <div class="bar-count">${count}</div>
            `;
            
            ratingBars.appendChild(ratingBar);
        }
    }

    // Render reviews
    function renderReviews() {
        const reviewList = document.getElementById('review-list');
        reviewList.innerHTML = '';
        
        if (reviews.length === 0) {
            reviewList.innerHTML = '<p style="text-align: center; color: var(--secondary-text);">No reviews yet. Be the first to review this product!</p>';
            return;
        }
        
        reviews.forEach(review => {
            const reviewItem = document.createElement('div');
            reviewItem.className = 'review-item';
            
            const starsHtml = createStarsHTML(review.rating);
            
            reviewItem.innerHTML = `
                <div class="review-header">
                    <div class="reviewer-info">
                        <div class="reviewer-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <div class="reviewer-name">${review.reviewerName || 'Anonymous'}</div>
                            <div class="review-date">${formatDate(review.createdAt)}</div>
                        </div>
                    </div>
                    <div class="stars">${starsHtml}</div>
                </div>
                <div class="review-content">
                    <h4 style="margin: 0 0 10px;">${review.title || ''}</h4>
                    <p>${review.content}</p>
                </div>
                <div class="review-helpful">
                    <button class="helpful-btn" data-review-id="${review.id}">
                        <i class="fas fa-thumbs-up"></i> Helpful (${review.helpfulCount || 0})
                    </button>
                    <button class="helpful-btn" data-review-id="${review.id}">
                        <i class="fas fa-thumbs-down"></i> Not Helpful
                    </button>
                </div>
            `;
            
            reviewList.appendChild(reviewItem);
        });
    }

    // Create stars HTML
    function createStarsHTML(rating) {
        let stars = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= rating) {
                stars += '<i class="fas fa-star"></i>';
            } else if (i - 0.5 <= rating) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            } else {
                stars += '<i class="far fa-star"></i>';
            }
        }
        return stars;
    }

    // Format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }

    // Update specifications
    function updateSpecifications() {
        const specsTable = document.getElementById('specs-table');
        specsTable.innerHTML = '';
        
        if (currentProduct.specifications) {
            Object.entries(currentProduct.specifications).forEach(([key, value]) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${key}</td>
                    <td>${value}</td>
                `;
                specsTable.appendChild(row);
            });
        }
    }

    // Update shipping info
    function updateShippingInfo() {
        const shippingContent = document.getElementById('shipping-info-content');
        
        shippingContent.innerHTML = `
            <h3>Shipping Information</h3>
            <p>We offer free standard shipping on all orders over $100. Orders placed before 2 PM EST Monday-Friday are processed and shipped the same day.</p>
            
            <ul class="product-features">
                <li><i class="fas fa-truck"></i> Standard Shipping: 3-5 business days (FREE over $100)</li>
                <li><i class="fas fa-rocket"></i> Express Shipping: 1-2 business days ($12.99)</li>
                <li><i class="fas fa-bolt"></i> Overnight Shipping: Next business day ($24.99)</li>
            </ul>
            
            <h3>Return Policy</h3>
            <p>We offer a 30-day return policy from the date of delivery. Items must be in original condition with all accessories and packaging.</p>
            
            <h3>Warranty</h3>
            <p>All products come with a 1-year manufacturer's warranty covering defects in materials and workmanship.</p>
        `;
    }

    // Render related products
    function renderRelatedProducts(products) {
        const relatedContainer = document.getElementById('related-products');
        relatedContainer.innerHTML = '';
        
        products.forEach(product => {
            const productCard = document.createElement('a');
            productCard.className = 'product-card';
            productCard.href = `product-details.html?id=${product.id}`;
            
            const iconClass = getProductIcon(product.category);
            
            productCard.innerHTML = `
                <div class="product-image">
                    <i class="fas ${iconClass}" style="font-size: 60px; color: var(--accent-blue);"></i>
                </div>
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                </div>
            `;
            
            relatedContainer.appendChild(productCard);
        });
    }

    // Initialize event listeners
    function initEventListeners() {
        // Tabs
        initTabs();
        
        // Quantity selector
        initQuantitySelector();
        
        // Action buttons
        initActionButtons();
        
        // Review form
        initReviewForm();
        
        // Retry button
        document.getElementById('retry-load-btn').addEventListener('click', loadProductData);
    }

    // Initialize tabs
    function initTabs() {
        const tabHeaders = document.querySelectorAll('.tab-header');
        
        tabHeaders.forEach(header => {
            header.addEventListener('click', function() {
                const tabId = this.dataset.tab;
                
                // Remove active class from all headers
                tabHeaders.forEach(h => h.classList.remove('active'));
                
                // Add active class to clicked header
                this.classList.add('active');
                
                // Show corresponding content
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(`tab-${tabId}`).classList.add('active');
            });
        });
    }

    // Initialize quantity selector
    function initQuantitySelector() {
        const decreaseBtn = document.getElementById('decrease-qty');
        const increaseBtn = document.getElementById('increase-qty');
        const quantityInput = document.getElementById('quantity');
        
        decreaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if (currentValue > 1) {
                quantityInput.value = currentValue - 1;
            }
        });
        
        increaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(quantityInput.value);
            if (currentValue < 10) {
                quantityInput.value = currentValue + 1;
            }
        });
        
        quantityInput.addEventListener('change', function() {
            let value = parseInt(this.value);
            if (isNaN(value) || value < 1) {
                this.value = 1;
            } else if (value > 10) {
                this.value = 10;
            }
        });
    }

    // Initialize action buttons
    function initActionButtons() {
        const addToCartBtn = document.getElementById('add-to-cart-btn');
        const buyNowBtn = document.getElementById('buy-now-btn');
        const wishlistToggle = document.getElementById('wishlist-toggle');
        const writeReviewBtn = document.getElementById('write-review-btn');
        const showReviewFormBtn = document.getElementById('show-review-form-btn');
        const loadMoreReviewsBtn = document.getElementById('load-more-reviews');
        
        // Add to Cart
        addToCartBtn.addEventListener('click', async function() {
            if (this.classList.contains('disabled')) return;
            
            const quantity = parseInt(document.getElementById('quantity').value);
            
            try {
                await addToCartAPI(quantity);
                showMessage(`Added ${quantity} ${currentProduct.name} to cart`);
            } catch (error) {
                showError('Failed to add to cart. Please try again.');
            }
        });
        
        // Buy Now
        buyNowBtn.addEventListener('click', async function() {
            if (this.classList.contains('disabled')) return;
            
            const quantity = parseInt(document.getElementById('quantity').value);
            
            try {
                await addToCartAPI(quantity);
                window.location.href = 'checkout.html';
            } catch (error) {
                showError('Failed to process order. Please try again.');
            }
        });
        
        // Wishlist Toggle
        wishlistToggle.addEventListener('click', async function() {
            try {
                if (isInWishlist) {
                    await removeFromWishlist();
                    showMessage('Removed from wishlist');
                } else {
                    await addToWishlist();
                    showMessage('Added to wishlist');
                }
                
                isInWishlist = !isInWishlist;
                updateWishlistButton();
                
            } catch (error) {
                showError('Failed to update wishlist. Please try again.');
            }
        });
        
        // Write Review Button (inline)
        if (writeReviewBtn) {
            writeReviewBtn.addEventListener('click', function() {
                showReviewForm();
            });
        }
        
        // Show Review Form Button (in reviews tab)
        if (showReviewFormBtn) {
            showReviewFormBtn.addEventListener('click', function() {
                showReviewForm();
            });
        }
        
        // Load More Reviews
        if (loadMoreReviewsBtn) {
            loadMoreReviewsBtn.addEventListener('click', async function() {
                try {
                    currentReviewsPage++;
                    await loadMoreReviews();
                    renderReviews();
                } catch (error) {
                    showError('Failed to load more reviews.');
                }
            });
        }
    }

    // Initialize review form
    function initReviewForm() {
        const submitReviewBtn = document.getElementById('submit-review-btn');
        const cancelReviewBtn = document.getElementById('cancel-review-btn');
        
        if (submitReviewBtn) {
            submitReviewBtn.addEventListener('click', async function() {
                await submitReview();
            });
        }
        
        if (cancelReviewBtn) {
            cancelReviewBtn.addEventListener('click', function() {
                hideReviewForm();
            });
        }
    }

    // Initialize search
    function initSearch() {
        const searchInput = document.getElementById('global-search');
        let searchTimeout;
        
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                if (this.value.trim()) {
                    searchProducts(this.value.trim());
                }
            }, 500);
        });
    }

    // API Functions
    async function addToCartAPI(quantity) {
        const cartData = {
            productId: productId,
            quantity: quantity,
            variantId: currentVariant?.id,
            options: selectedOptions
        };
        
        await fetchAPI(API_ENDPOINTS.CART, {
            method: 'POST',
            body: JSON.stringify(cartData)
        });
        
        // Update cart count
        await updateCartCount();
    }

    async function addToWishlist() {
        await fetchAPI(API_ENDPOINTS.WISHLIST, {
            method: 'POST',
            body: JSON.stringify({ productId })
        });
    }

    async function removeFromWishlist() {
        await fetchAPI(API_ENDPOINTS.WISHLIST_ITEM.replace('{id}', productId), {
            method: 'DELETE'
        });
    }

    async function updateCartCount() {
        try {
            const cartData = await fetchAPI(API_ENDPOINTS.CART);
            const count = cartData.items ? cartData.items.reduce((sum, item) => sum + item.quantity, 0) : 0;
            
            // Update UI
            document.querySelectorAll('.cart-count, .mobile-cart-count').forEach(el => {
                el.textContent = count;
            });
        } catch (error) {
            console.error('Failed to update cart count:', error);
        }
    }

    async function loadMoreReviews() {
        const url = `${API_ENDPOINTS.PRODUCT_REVIEWS.replace('{id}', productId)}?page=${currentReviewsPage}&limit=${reviewsPerPage}`;
        const reviewsData = await fetchAPI(url);
        
        reviews = [...reviews, ...(reviewsData.reviews || [])];
    }

    async function submitReview() {
        if (!isUserLoggedIn()) {
            showMessage('Please login to write a review');
            return;
        }
        
        const rating = document.querySelector('input[name="rating"]:checked')?.value;
        const title = document.getElementById('review-title').value.trim();
        const content = document.getElementById('review-content').value.trim();
        const reviewerName = document.getElementById('reviewer-name').value.trim();
        
        if (!rating) {
            showError('Please select a rating');
            return;
        }
        
        if (!content) {
            showError('Please write your review');
            return;
        }
        
        const reviewData = {
            productId: productId,
            rating: parseInt(rating),
            title: title,
            content: content,
            reviewerName: reviewerName || undefined
        };
        
        try {
            await fetchAPI(API_ENDPOINTS.SUBMIT_REVIEW, {
                method: 'POST',
                body: JSON.stringify(reviewData)
            });
            
            showMessage('Thank you for your review!');
            hideReviewForm();
            
            // Reload reviews
            currentReviewsPage = 1;
            await loadReviews();
            updateReviewsUI();
            
        } catch (error) {
            showError('Failed to submit review. Please try again.');
        }
    }

    async function searchProducts(query) {
        try {
            const url = `${API_ENDPOINTS.SEARCH_PRODUCTS}?q=${encodeURIComponent(query)}`;
            const searchData = await fetchAPI(url);
            
            if (searchData.products && searchData.products.length > 0) {
                // Redirect to search results or update UI
                window.location.href = `products.html?q=${encodeURIComponent(query)}`;
            }
        } catch (error) {
            console.error('Search failed:', error);
        }
    }

    // UI Helper Functions
    function showReviewForm() {
        if (!isUserLoggedIn()) {
            showMessage('Please login to write a review');
            setTimeout(() => {
                window.location.href = 'login.html?return=' + encodeURIComponent(window.location.href);
            }, 1500);
            return;
        }
        
        document.getElementById('review-form').style.display = 'block';
        document.getElementById('show-review-form-btn').style.display = 'none';
        document.getElementById('load-more-reviews').style.display = 'none';
        
        // Scroll to review form
        document.getElementById('review-form').scrollIntoView({ behavior: 'smooth' });
    }

    function hideReviewForm() {
        document.getElementById('review-form').style.display = 'none';
        document.getElementById('show-review-form-btn').style.display = 'inline-block';
        document.getElementById('load-more-reviews').style.display = 'inline-block';
        
        // Clear form
        document.querySelectorAll('input[name="rating"]').forEach(input => input.checked = false);
        document.getElementById('review-title').value = '';
        document.getElementById('review-content').value = '';
        document.getElementById('reviewer-name').value = '';
    }

    function showLoading() {
        document.getElementById('loading-indicator').style.display = 'block';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('product-details-content').style.display = 'none';
    }

    function hideLoading() {
        document.getElementById('loading-indicator').style.display = 'none';
    }

    function showContent() {
        document.getElementById('product-details-content').style.display = 'block';
    }

    function showError(message) {
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-text').textContent = message;
    }

    function showMessage(message) {
        if (window.XSHeader && window.XSHeader.showMessage) {
            window.XSHeader.showMessage(message);
        } else {
            // Simple notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary-blue);
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    }

    // API Endpoints Documentation
    function listAPIEndpoints() {
        console.log('=== Product Details API Endpoints ===');
        console.log('Base URL:', API_BASE_URL);
        
        console.log('\nProduct Management:');
        console.log('- GET    /api/v1/products/{id}           - Get product details');
        console.log('- GET    /api/v1/products/{id}/variants  - Get product variants');
        console.log('- GET    /api/v1/products/{id}/options   - Get product options');
        console.log('- GET    /api/v1/products/{id}/related   - Get related products');
        
        console.log('\nReview Management:');
        console.log('- GET    /api/v1/products/{id}/reviews   - Get product reviews');
        console.log('- POST   /api/v1/reviews                 - Submit review');
        console.log('- PUT    /api/v1/reviews/{id}            - Update review');
        console.log('- DELETE /api/v1/reviews/{id}            - Delete review');
        console.log('- POST   /api/v1/reviews/{id}/helpful    - Mark review as helpful');
        
        console.log('\nWishlist Management:');
        console.log('- GET    /api/v1/wishlist                - Get wishlist');
        console.log('- POST   /api/v1/wishlist                - Add to wishlist');
        console.log('- DELETE /api/v1/wishlist/{id}           - Remove from wishlist');
        console.log('- GET    /api/v1/wishlist/check/{id}     - Check if in wishlist');
        
        console.log('\nCart Management:');
        console.log('- GET    /api/v1/cart                    - Get cart');
        console.log('- POST   /api/v1/cart                    - Add to cart');
        console.log('- PUT    /api/v1/cart/{id}               - Update cart item');
        console.log('- DELETE /api/v1/cart/{id}               - Remove from cart');
        
        console.log('\nOrder Management:');
        console.log('- POST   /api/v1/orders                  - Create order');
        console.log('- POST   /api/v1/orders/quick            - Quick order (buy now)');
        
        console.log('\nInventory Management:');
        console.log('- GET    /api/v1/inventory/{id}          - Check stock');
        console.log('- GET    /api/v1/inventory/{id}/levels   - Get stock levels');
        
        console.log('\nShipping Management:');
        console.log('- GET    /api/v1/shipping/products/{id}  - Get shipping info');
        console.log('- POST   /api/v1/shipping/calculate      - Calculate shipping');
        
        console.log('\nAnalytics & Recommendations:');
        console.log('- POST   /api/v1/analytics/products/{id}/view - Track product view');
        console.log('- GET    /api/v1/recommendations/products/{id} - Get recommendations');
        
        console.log('\nUser Management:');
        console.log('- GET    /api/v1/user/profile            - Get user profile');
        console.log('- GET    /api/v1/user/reviews            - Get user reviews');
        
        console.log('\nSearch & Comparison:');
        console.log('- GET    /api/v1/search/products         - Search products');
        console.log('- POST   /api/v1/compare                 - Compare products');
        
        console.log('\nPrice Alerts:');
        console.log('- GET    /api/v1/price-alerts            - Get price alerts');
        console.log('- POST   /api/v1/price-alerts/products/{id} - Create price alert');
        
        console.log('\nQuestions & Answers:');
        console.log('- GET    /api/v1/products/{id}/questions - Get product questions');
        console.log('- POST   /api/v1/questions               - Submit question');
        console.log('- POST   /api/v1/questions/{id}/answer   - Answer question');
        
        console.log('\n======================================');
    }

    // Initialize and log endpoints
    listAPIEndpoints();
</script>
</body>
</html>