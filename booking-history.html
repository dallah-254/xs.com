<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XS Platform - Booking History</title>
    <link rel="stylesheet" href="header-footer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* BOOKING HISTORY PAGE SPECIFIC STYLES */
        .booking-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-blue) 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .booking-header h1 {
            font-size: 2.2rem;
            margin: 0 0 10px;
        }

        .booking-header p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Booking Container */
        .booking-container {
            max-width: 1200px;
            margin: 0 auto 50px;
        }

        /* Filter Controls */
        .filter-controls {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-text);
            font-size: 0.9rem;
        }

        .filter-select,
        .filter-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--light-bg);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }

        .filter-select:focus,
        .filter-input:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .filter-actions {
            display: flex;
            gap: 10px;
        }

        .filter-btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.95rem;
        }

        .apply-btn {
            background: var(--primary-blue);
            color: white;
        }

        .apply-btn:hover {
            background: var(--accent-blue);
        }

        .reset-btn {
            background: white;
            color: var(--secondary-text);
            border: 2px solid var(--light-bg);
        }

        .reset-btn:hover {
            background: var(--light-bg);
        }

        /* Status Tabs */
        .status-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .status-tab {
            padding: 10px 25px;
            border-radius: 20px;
            background: var(--light-bg);
            color: var(--secondary-text);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .status-tab:hover {
            background: #e0e0e0;
        }

        .status-tab.active {
            background: var(--primary-blue);
            color: white;
        }

        /* Booking Cards Grid */
        .bookings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        /* Booking Card */
        .booking-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .booking-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .booking-header-bar {
            padding: 20px;
            background: var(--light-bg);
            border-bottom: 2px solid #e0e0e0;
        }

        .booking-id {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-text);
            margin: 0 0 5px;
        }

        .booking-date {
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        .booking-content {
            padding: 25px;
        }

        .booking-service {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .service-icon {
            width: 50px;
            height: 50px;
            background: var(--light-bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-size: 1.5rem;
        }

        .service-details h3 {
            margin: 0 0 5px;
            color: var(--primary-text);
            font-size: 1.2rem;
        }

        .service-details p {
            margin: 0;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        .booking-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 8px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            font-size: 0.8rem;
            color: var(--secondary-text);
            margin-bottom: 3px;
        }

        .info-value {
            font-weight: 600;
            color: var(--primary-text);
        }

        .booking-status {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
            display: inline-block;
            margin-bottom: 20px;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-in-progress {
            background: #cce5ff;
            color: #004085;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .booking-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .booking-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .view-btn {
            background: var(--light-bg);
            color: var(--primary-text);
        }

        .view-btn:hover {
            background: var(--accent-blue);
            color: white;
        }

        .reschedule-btn {
            background: white;
            color: var(--primary-blue);
            border: 2px solid var(--primary-blue);
        }

        .reschedule-btn:hover {
            background: var(--primary-blue);
            color: white;
        }

        .cancel-btn {
            background: white;
            color: #ff4757;
            border: 2px solid #ff4757;
        }

        .cancel-btn:hover {
            background: #ff4757;
            color: white;
        }

        /* No Bookings Message */
        .no-bookings {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }

        .no-bookings-icon {
            font-size: 4rem;
            color: var(--light-bg);
            margin-bottom: 20px;
        }

        .no-bookings h2 {
            color: var(--primary-text);
            margin: 0 0 15px;
        }

        .no-bookings p {
            color: var(--secondary-text);
            margin: 0 0 25px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .book-service-btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary-blue);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .book-service-btn:hover {
            background: var(--accent-blue);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--light-bg);
            background: white;
            color: var(--primary-text);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .page-btn:hover:not(:disabled) {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-numbers {
            display: flex;
            gap: 5px;
        }

        .page-number {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid var(--light-bg);
            background: white;
            color: var(--primary-text);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .page-number:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .page-number.active {
            background: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        /* Stats Summary */
        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .stat-icon {
            font-size: 2.5rem;
            color: var(--primary-blue);
            margin-bottom: 15px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-text);
            margin: 0 0 5px;
        }

        .stat-label {
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        /* Loading State */
        .loading-indicator {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-blue);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error-message {
            background: #ffeaea;
            color: #e74c3c;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .bookings-grid {
                grid-template-columns: 1fr;
            }

            .controls-row {
                flex-direction: column;
            }

            .filter-group {
                min-width: 100%;
            }

            .filter-actions {
                width: 100%;
            }

            .filter-btn {
                flex: 1;
            }

            .booking-actions {
                flex-direction: column;
            }

            .booking-btn {
                min-width: 100%;
            }

            .pagination {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 480px) {
            .booking-header h1 {
                font-size: 1.8rem;
            }

            .booking-info {
                grid-template-columns: 1fr;
            }

            .status-tabs {
                justify-content: center;
            }

            .stat-card {
                padding: 20px 15px;
            }
        }
    </style>
</head>
<body>
<header class="main-header">
    <!-- Same header as other pages -->
    <div class="header-top-row">
        <div class="logo-and-nav">
            <div class="logo">XS</div>
            <div class="slogan">Electronics Shop & Repair Services</div>
            <nav class="main-nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="products.html" class="nav-link">Products</a> 
                <a href="services.html" class="nav-link">Services</a>
                <a href="deals.html" class="nav-link">Deals</a>
                <a href="support.html" class="nav-link">Support</a>
            </nav>
        </div>

        <div class="search-and-actions">
            <div class="search-bar-top">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search products, services, or brands..." class="search-input">
            </div>

            <div class="auth-state">
                <div class="logged-out-state" id="logged-out-state">
                    <a href="login.html" class="auth-link login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log in
                    </a>
                </div>
                
                <div class="logged-in-state" id="logged-in-state" style="display: none;">
                    <div class="user-profile">
                        <button class="user-menu-btn" id="user-menu-btn" aria-label="Open account menu">
                            <i class="fas fa-user-circle"></i>
                        </button>
                        <div class="user-dropdown" id="user-dropdown">
                            <a href="user-dashboard.html" class="dropdown-item">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                            <a href="profile.html" class="dropdown-item">
                                <i class="fas fa-user"></i> My Profile
                            </a>
                            <a href="orders.html" class="dropdown-item">
                                <i class="fas fa-box"></i> My Orders
                            </a>
                            <a href="booking-history.html" class="dropdown-item active">
                                <i class="fas fa-calendar-alt"></i> Booking History
                            </a>
                            <a href="wishlist.html" class="dropdown-item">
                                <i class="fas fa-heart"></i> Wishlist
                            </a>
                            <div class="dropdown-divider"></div>
                            <button class="dropdown-item logout-btn" id="logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <button class="btn-wishlist" id="wishlist-btn">
                <i class="fas fa-heart"></i> 
                <span class="wishlist-count">0</span>
            </button>
            
            <button class="btn-submit" id="cart-btn"><i class="fas fa-shopping-cart"></i> Cart <span class="cart-count">0</span></button>
            
            <button class="mobile-search-btn" id="mobile-search-btn">
                <i class="fas fa-search"></i>
            </button>
            
            <button class="mobile-menu-btn" id="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Search Bar -->
    <div class="mobile-search-bar" id="mobile-search-bar">
        <div class="mobile-search-container">
            <input type="text" placeholder="Search..." class="mobile-search-input">
            <button class="mobile-search-close" id="mobile-search-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- Mobile Menu Panel -->
    <div class="mobile-menu-panel" id="mobile-menu-panel">
        <div class="mobile-menu-header">
            <div class="mobile-logo">XS</div>
            <button class="mobile-menu-close" id="mobile-menu-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="mobile-menu-content">
            <div class="mobile-auth-state">
                <div class="mobile-logged-out-state" id="mobile-logged-out-state">
                    <a href="login.html" class="mobile-auth-link login-btn">
                        <i class="fas fa-sign-in-alt"></i> Log in
                    </a>
                </div>
                
                <div class="mobile-logged-in-state" id="mobile-logged-in-state" style="display: none;">
                    <div class="mobile-user-info">
                        <div class="mobile-user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="mobile-user-details">
                            <div class="mobile-user-name" id="mobile-user-name">Welcome!</div>
                            <div class="mobile-user-email" id="mobile-user-email">user@example.com</div>
                        </div>
                    </div>
                    
                    <div class="mobile-user-menu">
                        <a href="user-dashboard.html" class="mobile-nav-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="profile.html" class="mobile-nav-link">
                            <i class="fas fa-user"></i> My Profile
                        </a>
                        <a href="orders.html" class="mobile-nav-link">
                            <i class="fas fa-box"></i> My Orders
                        </a>
                        <a href="booking-history.html" class="mobile-nav-link active">
                            <i class="fas fa-calendar-alt"></i> Booking History
                        </a>
                        <a href="wishlist.html" class="mobile-nav-link">
                            <i class="fas fa-heart"></i> Wishlist
                        </a>
                        <div class="mobile-menu-divider"></div>
                        <button class="mobile-action-btn" id="mobile-logout-btn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="mobile-nav-section">
                <a href="index.html" class="mobile-nav-link">
                    <i class="fas fa-home"></i> Home
                </a>
                <a href="products.html" class="mobile-nav-link">
                    <i class="fas fa-shopping-bag"></i> Products
                </a>
                <a href="services.html" class="mobile-nav-link">
                    <i class="fas fa-tools"></i> Services
                </a>
                <a href="deals.html" class="mobile-nav-link">
                    <i class="fas fa-tag"></i> Deals
                </a>
                <a href="support.html" class="mobile-nav-link">
                    <i class="fas fa-headset"></i> Support
                </a>
            </div>
            
            <div class="mobile-actions-section">
                <button class="mobile-action-btn" id="mobile-wishlist-btn">
                    <i class="fas fa-heart"></i> Wishlist <span class="mobile-wishlist-count">0</span>
                </button>
                <button class="mobile-action-btn" id="mobile-cart-btn">
                    <i class="fas fa-shopping-cart"></i> Cart <span class="mobile-cart-count">0</span>
                </button>
            </div>
        </div>
    </div>
</header>

<main class="main-content">
    <!-- Booking Header -->
    <section class="booking-header">
        <h1>Booking History</h1>
        <p>View and manage all your service appointments and repair bookings</p>
    </section>

    <!-- Booking Container -->
    <div class="booking-container">
        <!-- Stats Summary -->
        <div class="stats-summary" id="stats-summary">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <!-- Filter Controls -->
        <section class="filter-controls">
            <div class="controls-row">
                <div class="filter-group">
                    <label for="date-filter">Date Range</label>
                    <select class="filter-select" id="date-filter">
                        <option value="">All Time</option>
                        <option value="week">Last 7 Days</option>
                        <option value="month">Last 30 Days</option>
                        <option value="quarter">Last 3 Months</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="service-filter">Service Type</label>
                    <select class="filter-select" id="service-filter">
                        <option value="">All Services</option>
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="status-filter">Status</label>
                    <select class="filter-select" id="status-filter">
                        <option value="">All Statuses</option>
                        <option value="pending">Pending</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="in-progress">In Progress</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="search-booking">Search Booking ID</label>
                    <input type="text" id="search-booking" class="filter-input" placeholder="Enter booking ID...">
                </div>
                
                <div class="filter-actions">
                    <button class="filter-btn apply-btn" id="apply-filters">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <button class="filter-btn reset-btn" id="reset-filters">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
        </section>

        <!-- Status Tabs -->
        <div class="status-tabs" id="status-tabs">
            <!-- Tabs will be populated by JavaScript -->
        </div>

        <!-- Loading State -->
        <div class="loading-indicator" id="loading-indicator">
            <div class="loading-spinner"></div>
            <p>Loading your bookings...</p>
        </div>

        <!-- Error State -->
        <div class="error-message" id="error-message" style="display: none;">
            <p>Error loading bookings. Please try again later.</p>
            <button class="btn-pro" id="retry-load-btn">Retry</button>
        </div>

        <!-- Bookings Grid -->
        <div class="bookings-grid" id="bookings-grid">
            <!-- Booking cards will be populated by JavaScript -->
        </div>

        <!-- No Bookings Message -->
        <div class="no-bookings" id="no-bookings-message" style="display: none;">
            <div class="no-bookings-icon">
                <i class="fas fa-calendar-times"></i>
            </div>
            <h2>No Bookings Found</h2>
            <p>You haven't booked any services yet. Browse our services and schedule your first appointment!</p>
            <a href="services.html" class="book-service-btn">
                <i class="fas fa-tools"></i> Book a Service
            </a>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <!-- Pagination will be populated by JavaScript -->
        </div>
    </div>
</main>

<footer class="main-footer">
    <!-- Same footer as other pages -->
    <div class="footer-content">
        <div class="footer-section">
            <h4>XS Platform</h4>
            <p>Your trusted source for electronics and repair services since 2024.</p>
        </div>
        
        <div class="footer-section">
            <h4>Shop</h4>
            <ul class="footer-links">
                <li><a href="products.html">All Products</a></li>
                <li><a href="products.html?category=new">New Arrivals</a></li>
                <li><a href="products.html?category=bestsellers">Best Sellers</a></li>
                <li><a href="deals.html">Deals & Discounts</a></li>
                <li><a href="services.html">Repair Services</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Customer Service</h4>
            <ul class="footer-links">
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="support.html">Support Center</a></li>
                <li><a href="faq.html">FAQ</a></li>
                <li><a href="shipping.html">Shipping Info</a></li>
                <li><a href="returns.html">Returns & Exchanges</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Account</h4>
            <ul class="footer-links">
                <li><a href="login.html">Sign In</a></li>
                <li><a href="register.html">Create Account</a></li>
                <li><a href="user-dashboard.html">My Dashboard</a></li>
                <li><a href="orders.html">Order History</a></li>
                <li><a href="booking-history.html">Booking History</a></li>
                <li><a href="wishlist.html">Wishlist</a></li>
            </ul>
        </div>
        
        <div class="footer-section">
            <h4>Legal</h4>
            <ul class="footer-links">
                <li><a href="privacy-policy.html">Privacy Policy</a></li>
                <li><a href="terms.html">Terms of Service</a></li>
                <li><a href="cookies.html">Cookie Policy</a></li>
            </ul>
        </div>
    </div>
    
    <div class="copyright">
        &copy; 2024 XS Platform. All rights reserved.
    </div>
</footer>

<!-- Link to shared JavaScript file -->
<script src="header-footer.js"></script>

<!-- Booking History Specific JavaScript with API Integration -->
<script>
    // API Configuration
    const API_BASE_URL = 'https://api.xsplatform.com'; // Replace with your actual API base URL
    const API_ENDPOINTS = {
        BOOKINGS: `${API_BASE_URL}/api/v1/bookings`,
        BOOKING_DETAIL: `${API_BASE_URL}/api/v1/bookings/{id}`,
        BOOKING_CANCEL: `${API_BASE_URL}/api/v1/bookings/{id}/cancel`,
        BOOKING_RESCHEDULE: `${API_BASE_URL}/api/v1/bookings/{id}/reschedule`,
        BOOKING_STATS: `${API_BASE_URL}/api/v1/bookings/stats`,
        BOOKING_SERVICE_TYPES: `${API_BASE_URL}/api/v1/services/types`,
        BOOKING_SEARCH: `${API_BASE_URL}/api/v1/bookings/search`,
        BOOKING_FILTER_OPTIONS: `${API_BASE_URL}/api/v1/bookings/filter-options`
    };

    // Current state
    let currentPage = 1;
    let bookingsPerPage = 8;
    let totalBookings = 0;
    let allBookings = [];
    let filteredBookings = [];
    let currentFilters = {
        status: '',
        serviceType: '',
        dateRange: '',
        searchQuery: '',
        startDate: '',
        endDate: ''
    };
    let bookingStats = {
        total: 0,
        pending: 0,
        confirmed: 0,
        inProgress: 0,
        completed: 0,
        cancelled: 0
    };

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Booking History page initialized with API integration');
        
        // Load initial data
        loadBookingStats();
        loadBookings();
        loadServiceTypes();
        
        // Initialize event listeners
        initFilters();
        initEventListeners();
        
        // Check for URL parameters
        checkUrlParams();
    });

    // API Helper Functions
    async function fetchAPI(url, options = {}) {
        try {
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getAuthToken()}`
                },
                ...options
            };
            
            const response = await fetch(url, defaultOptions);
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API Fetch Error:', error);
            showError('Failed to load data. Please try again.');
            throw error;
        }
    }

    function getAuthToken() {
        // Get auth token from localStorage or cookies
        return localStorage.getItem('xs_auth_token') || '';
    }

    // Load booking statistics
    async function loadBookingStats() {
        try {
            const data = await fetchAPI(API_ENDPOINTS.BOOKING_STATS);
            
            bookingStats = {
                total: data.total || 0,
                pending: data.pending || 0,
                confirmed: data.confirmed || 0,
                inProgress: data.inProgress || 0,
                completed: data.completed || 0,
                cancelled: data.cancelled || 0
            };
            
            renderStats();
            renderStatusTabs();
            
        } catch (error) {
            console.error('Failed to load booking stats:', error);
        }
    }

    // Load bookings from API
    async function loadBookings() {
        try {
            showLoading();
            
            const params = new URLSearchParams({
                page: currentPage,
                limit: bookingsPerPage,
                ...currentFilters
            });
            
            const data = await fetchAPI(`${API_ENDPOINTS.BOOKINGS}?${params}`);
            
            allBookings = data.bookings || [];
            filteredBookings = [...allBookings];
            totalBookings = data.total || allBookings.length;
            
            hideLoading();
            renderBookings();
            renderPagination();
            
            // Update stats if needed
            updateStatsCounts();
            
        } catch (error) {
            hideLoading();
            showError('Failed to load bookings');
        }
    }

    // Load service types for filter
    async function loadServiceTypes() {
        try {
            const data = await fetchAPI(API_ENDPOINTS.BOOKING_SERVICE_TYPES);
            const serviceFilter = document.getElementById('service-filter');
            
            if (data.types && serviceFilter) {
                data.types.forEach(serviceType => {
                    const option = document.createElement('option');
                    option.value = serviceType.id;
                    option.textContent = serviceType.name;
                    serviceFilter.appendChild(option);
                });
            }
            
        } catch (error) {
            console.error('Failed to load service types:', error);
        }
    }

    // Render booking statistics
    function renderStats() {
        const statsSummary = document.getElementById('stats-summary');
        
        statsSummary.innerHTML = `
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-number">${bookingStats.total}</div>
                <div class="stat-label">Total Bookings</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-number">${bookingStats.pending}</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="stat-number">${bookingStats.inProgress}</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-number">${bookingStats.completed}</div>
                <div class="stat-label">Completed</div>
            </div>
        `;
    }

    // Render status tabs
    function renderStatusTabs() {
        const statusTabs = document.getElementById('status-tabs');
        
        statusTabs.innerHTML = `
            <button class="status-tab active" data-status="all">
                All Bookings (${bookingStats.total})
            </button>
            <button class="status-tab" data-status="pending">
                Pending (${bookingStats.pending})
            </button>
            <button class="status-tab" data-status="confirmed">
                Confirmed (${bookingStats.confirmed})
            </button>
            <button class="status-tab" data-status="in-progress">
                In Progress (${bookingStats.inProgress})
            </button>
            <button class="status-tab" data-status="completed">
                Completed (${bookingStats.completed})
            </button>
            <button class="status-tab" data-status="cancelled">
                Cancelled (${bookingStats.cancelled})
            </button>
        `;
        
        // Add event listeners to tabs
        statusTabs.querySelectorAll('.status-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Update active tab
                statusTabs.querySelectorAll('.status-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update filter
                const status = this.getAttribute('data-status');
                currentFilters.status = status === 'all' ? '' : status;
                
                // Reset to first page
                currentPage = 1;
                
                // Load bookings with new filter
                loadBookings();
            });
        });
    }

    // Render bookings
    function renderBookings() {
        const bookingsGrid = document.getElementById('bookings-grid');
        const noBookingsMessage = document.getElementById('no-bookings-message');
        
        if (filteredBookings.length === 0) {
            bookingsGrid.innerHTML = '';
            noBookingsMessage.style.display = 'block';
            return;
        }
        
        noBookingsMessage.style.display = 'none';
        
        // Clear grid
        bookingsGrid.innerHTML = '';
        
        // Render booking cards
        filteredBookings.forEach(booking => {
            const bookingCard = createBookingCard(booking);
            bookingsGrid.appendChild(bookingCard);
        });
    }

    // Create booking card HTML
    function createBookingCard(booking) {
        const card = document.createElement('div');
        card.className = 'booking-card';
        card.setAttribute('data-status', booking.status);
        
        // Format dates
        const bookedDate = new Date(booking.createdAt).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
        
        const appointmentDate = booking.appointmentDate 
            ? new Date(booking.appointmentDate).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            })
            : 'TBD';
        
        // Get status class and text
        const statusClass = `status-${booking.status.replace(' ', '-')}`;
        const statusText = booking.status.replace('-', ' ').toUpperCase();
        
        // Get service icon
        const serviceIcon = getServiceIcon(booking.serviceType);
        
        // Format cost
        const formattedCost = booking.totalCost 
            ? `$${parseFloat(booking.totalCost).toFixed(2)}`
            : 'TBD';
        
        card.innerHTML = `
            <div class="booking-header-bar">
                <h3 class="booking-id">Booking #${booking.bookingId}</h3>
                <div class="booking-date">Booked: ${bookedDate}</div>
            </div>
            
            <div class="booking-content">
                <div class="booking-service">
                    <div class="service-icon">
                        <i class="${serviceIcon}"></i>
                    </div>
                    <div class="service-details">
                        <h3>${booking.serviceName}</h3>
                        <p>${booking.deviceType || ''} â€¢ ${booking.serviceCategory || 'General Service'}</p>
                    </div>
                </div>
                
                <div class="booking-info">
                    <div class="info-item">
                        <span class="info-label">Appointment Date</span>
                        <span class="info-value">${appointmentDate}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Time Slot</span>
                        <span class="info-value">${booking.timeSlot || 'TBD'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">${booking.technician ? 'Technician' : 'Service Type'}</span>
                        <span class="info-value">${booking.technician || booking.serviceType}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Total ${booking.status === 'completed' ? 'Paid' : 'Cost'}</span>
                        <span class="info-value">${formattedCost}</span>
                    </div>
                </div>
                
                <div class="booking-status ${statusClass}">${statusText}</div>
                
                <div class="booking-actions">
                    <button class="booking-btn view-btn" data-id="${booking.id}">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                    ${booking.status === 'pending' || booking.status === 'confirmed' ? `
                        <button class="booking-btn reschedule-btn" data-id="${booking.id}">
                            <i class="fas fa-calendar-alt"></i> Reschedule
                        </button>
                    ` : ''}
                    ${booking.status === 'pending' || booking.status === 'confirmed' ? `
                        <button class="booking-btn cancel-btn" data-id="${booking.id}">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                    ` : ''}
                    ${booking.status === 'completed' ? `
                        <button class="booking-btn view-btn" data-id="${booking.id}" data-action="review">
                            <i class="fas fa-star"></i> Write Review
                        </button>
                    ` : ''}
                </div>
            </div>
        `;
        
        return card;
    }

    // Get service icon based on service type
    function getServiceIcon(serviceType) {
        const iconMap = {
            'screen-repair': 'fas fa-mobile-alt',
            'battery-replacement': 'fas fa-battery-full',
            'diagnostic': 'fas fa-stethoscope',
            'software': 'fas fa-code',
            'hardware': 'fas fa-microchip',
            'cleaning': 'fas fa-spray-can',
            'installation': 'fas fa-tools',
            'maintenance': 'fas fa-cogs'
        };
        
        return iconMap[serviceType] || 'fas fa-tools';
    }

    // Render pagination
    function renderPagination() {
        const pagination = document.getElementById('pagination');
        const totalPages = Math.ceil(totalBookings / bookingsPerPage);
        
        if (totalPages <= 1) {
            pagination.innerHTML = '';
            return;
        }
        
        let paginationHtml = '';
        
        // Previous button
        paginationHtml += `
            <button class="page-btn prev ${currentPage === 1 ? 'disabled' : ''}" 
                    data-page="${currentPage - 1}">
                <i class="fas fa-chevron-left"></i>
            </button>
        `;
        
        // Page numbers
        const maxVisiblePages = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
        
        // Adjust if we're near the end
        if (endPage - startPage + 1 < maxVisiblePages) {
            startPage = Math.max(1, endPage - maxVisiblePages + 1);
        }
        
        // First page if not in range
        if (startPage > 1) {
            paginationHtml += `
                <button class="page-btn" data-page="1">1</button>
                ${startPage > 2 ? '<span class="page-dots">...</span>' : ''}
            `;
        }
        
        // Page numbers
        for (let i = startPage; i <= endPage; i++) {
            paginationHtml += `
                <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                        data-page="${i}">${i}</button>
            `;
        }
        
        // Last page if not in range
        if (endPage < totalPages) {
            paginationHtml += `
                ${endPage < totalPages - 1 ? '<span class="page-dots">...</span>' : ''}
                <button class="page-btn" data-page="${totalPages}">${totalPages}</button>
            `;
        }
        
        // Next button
        paginationHtml += `
            <button class="page-btn next ${currentPage === totalPages ? 'disabled' : ''}" 
                    data-page="${currentPage + 1}">
                <i class="fas fa-chevron-right"></i>
            </button>
        `;
        
        pagination.innerHTML = paginationHtml;
        
        // Add event listeners
        pagination.querySelectorAll('.page-btn:not(.disabled)').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = parseInt(btn.dataset.page);
                if (page && page !== currentPage) {
                    currentPage = page;
                    loadBookings();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            });
        });
    }

    // Initialize filters
    function initFilters() {
        // Apply filters button
        document.getElementById('apply-filters').addEventListener('click', applyFilters);
        
        // Reset filters button
        document.getElementById('reset-filters').addEventListener('click', resetFilters);
        
        // Search input with debounce
        let searchTimeout;
        document.getElementById('search-booking').addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                applyFilters();
            }, 500);
        });
        
        // Date filter change
        document.getElementById('date-filter').addEventListener('change', function() {
            if (this.value === 'custom') {
                // Show custom date inputs (simplified for demo)
                const startDate = prompt('Enter start date (YYYY-MM-DD):');
                const endDate = prompt('Enter end date (YYYY-MM-DD):');
                
                if (startDate && endDate) {
                    currentFilters.startDate = startDate;
                    currentFilters.endDate = endDate;
                    applyFilters();
                } else {
                    this.value = '';
                }
            }
        });
    }

    // Apply filters
    function applyFilters() {
        currentFilters = {
            status: document.getElementById('status-filter').value,
            serviceType: document.getElementById('service-filter').value,
            dateRange: document.getElementById('date-filter').value,
            searchQuery: document.getElementById('search-booking').value,
            startDate: currentFilters.startDate || '',
            endDate: currentFilters.endDate || ''
        };
        
        // Reset to first page
        currentPage = 1;
        
        // Load bookings with filters
        loadBookings();
    }

    // Reset filters
    function resetFilters() {
        // Reset filter inputs
        document.getElementById('status-filter').value = '';
        document.getElementById('service-filter').value = '';
        document.getElementById('date-filter').value = '';
        document.getElementById('search-booking').value = '';
        
        // Reset current filters
        currentFilters = {
            status: '',
            serviceType: '',
            dateRange: '',
            searchQuery: '',
            startDate: '',
            endDate: ''
        };
        
        // Reset active tab to "All"
        const statusTabs = document.getElementById('status-tabs');
        statusTabs.querySelectorAll('.status-tab').forEach(tab => tab.classList.remove('active'));
        statusTabs.querySelector('.status-tab[data-status="all"]').classList.add('active');
        
        // Reset to first page
        currentPage = 1;
        
        // Load bookings
        loadBookings();
    }

    // Initialize event listeners
    function initEventListeners() {
        // View details button clicks
        document.addEventListener('click', function(e) {
            const viewBtn = e.target.closest('.view-btn');
            if (viewBtn) {
                e.preventDefault();
                const bookingId = viewBtn.dataset.id;
                const action = viewBtn.dataset.action;
                
                if (action === 'review') {
                    writeReview(bookingId);
                } else {
                    viewBookingDetails(bookingId);
                }
            }
        });
        
        // Reschedule button clicks
        document.addEventListener('click', function(e) {
            const rescheduleBtn = e.target.closest('.reschedule-btn');
            if (rescheduleBtn) {
                e.preventDefault();
                const bookingId = rescheduleBtn.dataset.id;
                rescheduleBooking(bookingId);
            }
        });
        
        // Cancel button clicks
        document.addEventListener('click', function(e) {
            const cancelBtn = e.target.closest('.cancel-btn');
            if (cancelBtn) {
                e.preventDefault();
                const bookingId = cancelBtn.dataset.id;
                cancelBooking(bookingId);
            }
        });
        
        // Retry button
        document.getElementById('retry-load-btn').addEventListener('click', loadBookings);
    }

    // View booking details
    async function viewBookingDetails(bookingId) {
        try {
            // Navigate to booking details page
            window.location.href = `booking-details.html?id=${bookingId}`;
            
        } catch (error) {
            showError('Failed to load booking details');
        }
    }

    // Reschedule booking
    async function rescheduleBooking(bookingId) {
        if (confirm('Do you want to reschedule this booking?')) {
            try {
                // In a real implementation, this would open a reschedule modal
                // For now, navigate to booking form with reschedule action
                window.location.href = `booking-form.html?booking=${bookingId}&action=reschedule`;
                
            } catch (error) {
                showError('Failed to reschedule booking');
            }
        }
    }

    // Cancel booking
    async function cancelBooking(bookingId) {
        if (confirm('Are you sure you want to cancel this booking?')) {
            try {
                showLoading();
                
                await fetchAPI(API_ENDPOINTS.BOOKING_CANCEL.replace('{id}', bookingId), {
                    method: 'POST'
                });
                
                hideLoading();
                showMessage('Booking cancelled successfully');
                
                // Refresh bookings
                loadBookings();
                loadBookingStats();
                
            } catch (error) {
                hideLoading();
                showError('Failed to cancel booking');
            }
        }
    }

    // Write review
    function writeReview(bookingId) {
        window.location.href = `write-review.html?booking=${bookingId}`;
    }

    // Update stats counts (simplified for demo)
    function updateStatsCounts() {
        // In a real app, this would update counts based on filtered results
        const statsCards = document.querySelectorAll('.stat-card');
        if (statsCards.length > 0) {
            // Update total count in first card
            statsCards[0].querySelector('.stat-number').textContent = totalBookings;
        }
    }

    // Check URL parameters
    function checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const statusParam = urlParams.get('status');
        const bookingIdParam = urlParams.get('booking');
        
        if (statusParam) {
            // Set status filter
            document.getElementById('status-filter').value = statusParam;
            
            // Activate corresponding tab
            const statusTabs = document.getElementById('status-tabs');
            if (statusTabs) {
                statusTabs.querySelectorAll('.status-tab').forEach(tab => tab.classList.remove('active'));
                const targetTab = statusTabs.querySelector(`.status-tab[data-status="${statusParam}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            }
        }
        
        if (bookingIdParam) {
            // Set search query
            document.getElementById('search-booking').value = bookingIdParam;
        }
        
        // Apply filters if any URL parameters
        if (statusParam || bookingIdParam) {
            setTimeout(() => {
                applyFilters();
            }, 1000);
        }
    }

    // UI Helper Functions
    function showLoading() {
        document.getElementById('loading-indicator').style.display = 'block';
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('bookings-grid').innerHTML = '';
        document.getElementById('no-bookings-message').style.display = 'none';
    }

    function hideLoading() {
        document.getElementById('loading-indicator').style.display = 'none';
    }

    function showError(message) {
        document.getElementById('error-message').style.display = 'block';
        document.getElementById('error-message').querySelector('p').textContent = message;
        document.getElementById('loading-indicator').style.display = 'none';
    }

    function showMessage(message) {
        // Simple notification
        const notification = document.createElement('div');
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary-blue);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        `;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOut 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // API Endpoints Documentation for Booking History
    function listBookingAPIEndpoints() {
        console.log('=== XS Platform Booking API Endpoints ===');
        console.log('Base URL:', API_BASE_URL);
        console.log('\nBooking Endpoints:');
        console.log('- GET    /api/v1/bookings              - List bookings with pagination & filters');
        console.log('- GET    /api/v1/bookings/{id}         - Get booking details');
        console.log('- POST   /api/v1/bookings              - Create new booking');
        console.log('- PUT    /api/v1/bookings/{id}         - Update booking');
        console.log('- POST   /api/v1/bookings/{id}/cancel  - Cancel booking');
        console.log('- POST   /api/v1/bookings/{id}/reschedule - Reschedule booking');
        
        console.log('\nBooking Stats Endpoints:');
        console.log('- GET    /api/v1/bookings/stats        - Get booking statistics');
        console.log('- GET    /api/v1/bookings/filter-options - Get filter options');
        
        console.log('\nService Endpoints:');
        console.log('- GET    /api/v1/services/types        - Get service types');
        console.log('- GET    /api/v1/services/{id}         - Get service details');
        console.log('- GET    /api/v1/services/available-slots - Get available time slots');
        
        console.log('\nSearch Endpoints:');
        console.log('- GET    /api/v1/bookings/search       - Search bookings by ID or other criteria');
        
        console.log('\nReview Endpoints:');
        console.log('- GET    /api/v1/reviews/booking/{id}  - Get booking reviews');
        console.log('- POST   /api/v1/reviews               - Add review for booking');
        
        console.log('\n=================================');
    }

    // Initialize and log endpoints
    listBookingAPIEndpoints();
</script>
</body>
</html>