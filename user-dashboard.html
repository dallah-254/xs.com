<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard - XS Platform Kenya</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* USER DASHBOARD PAGE SPECIFIC STYLES */
        :root {
            --primary-blue: #2196f3;
            --accent-blue: #0d8bf2;
            --primary-text: #333;
            --secondary-text: #666;
            --light-bg: #f5f7fa;
            --success: #4caf50;
            --warning: #ff9800;
            --error: #f44336;
            --border-color: #e0e0e0;
            --kenya-green: #006600;
            --kenya-red: #BB0000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8f9fa;
            color: var(--primary-text);
            min-height: 100vh;
        }

        /* Header Styles */
        .main-header {
            background: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-top-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 30px;
            border-bottom: 1px solid var(--light-bg);
        }

        .logo-and-nav {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .logo {
            font-size: 28px;
            font-weight: 800;
            color: var(--kenya-green);
            background: linear-gradient(135deg, var(--kenya-green), var(--primary-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .slogan {
            color: var(--secondary-text);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .main-nav {
            display: flex;
            gap: 25px;
            margin-left: 20px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--primary-text);
            font-weight: 500;
            font-size: 0.95rem;
            padding: 8px 0;
            position: relative;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--primary-blue);
        }

        .nav-link.active {
            color: var(--primary-blue);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-blue);
            border-radius: 1px;
        }

        .badge-new {
            background: var(--kenya-red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .search-and-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .search-bar-top {
            display: flex;
            align-items: center;
            background: var(--light-bg);
            border-radius: 8px;
            padding: 10px 15px;
            min-width: 300px;
        }

        .search-bar-top i {
            color: var(--secondary-text);
            margin-right: 10px;
        }

        .search-input {
            border: none;
            background: none;
            outline: none;
            width: 100%;
            font-size: 0.9rem;
            color: var(--primary-text);
        }

        .search-input::placeholder {
            color: var(--secondary-text);
        }

        .auth-state {
            position: relative;
        }

        .user-profile {
            position: relative;
        }

        .user-menu-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary-text);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .user-menu-btn i {
            font-size: 24px;
            color: var(--primary-blue);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            margin-top: 10px;
            z-index: 1001;
            overflow: hidden;
        }

        .user-dropdown.active {
            display: block;
            animation: fadeIn 0.2s ease;
        }

        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--primary-text);
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.9rem;
        }

        .dropdown-item:hover {
            background: var(--light-bg);
            color: var(--primary-blue);
        }

        .dropdown-item i {
            width: 20px;
            color: var(--secondary-text);
        }

        .dropdown-item:hover i {
            color: var(--primary-blue);
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 5px 0;
        }

        .logout-btn {
            color: var(--error) !important;
        }

        .logout-btn i {
            color: var(--error) !important;
        }

        .btn-wishlist, .btn-submit {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .btn-wishlist {
            background: white;
            color: var(--primary-text);
            border: 1px solid var(--border-color);
        }

        .btn-wishlist:hover {
            background: var(--light-bg);
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .btn-submit {
            background: var(--primary-blue);
            color: white;
        }

        .btn-submit:hover {
            background: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .wishlist-count, .cart-count {
            background: var(--kenya-red);
            color: white;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-text);
            cursor: pointer;
        }

        /* Mobile Menu */
        .mobile-menu-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            overflow-y: auto;
        }

        .mobile-menu-panel.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        .mobile-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--light-bg);
        }

        .mobile-logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--kenya-green);
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--primary-text);
            cursor: pointer;
        }

        .mobile-menu-content {
            padding: 20px;
        }

        .mobile-auth-state {
            margin-bottom: 30px;
        }

        .mobile-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--light-bg);
        }

        .mobile-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--primary-blue);
        }

        .mobile-user-details {
            flex: 1;
        }

        .mobile-user-name {
            font-weight: 600;
            color: var(--primary-text);
            margin-bottom: 5px;
        }

        .mobile-user-email {
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        .mobile-user-menu {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .mobile-nav-link {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            text-decoration: none;
            color: var(--primary-text);
            border-radius: 8px;
            transition: background 0.2s;
        }

        .mobile-nav-link:hover {
            background: var(--light-bg);
            color: var(--primary-blue);
        }

        .mobile-nav-link i {
            width: 20px;
            color: var(--secondary-text);
        }

        .mobile-nav-link:hover i {
            color: var(--primary-blue);
        }

        .mobile-menu-divider {
            height: 1px;
            background: var(--border-color);
            margin: 15px 0;
        }

        .mobile-action-btn {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: none;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--primary-text);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .mobile-action-btn:hover {
            background: var(--light-bg);
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .mobile-action-btn.logout {
            color: var(--error);
            border-color: var(--error);
        }

        .mobile-action-btn.logout:hover {
            background: #ffebee;
        }

        .mobile-nav-section {
            display: flex;
            flex-direction: column;
            gap: 5px;
            margin-bottom: 30px;
        }

        .mobile-actions-section {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .mobile-badge-new {
            background: var(--kenya-red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
        }

        .mobile-wishlist-count, .mobile-cart-count {
            margin-left: auto;
            background: var(--kenya-red);
            color: white;
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 150px);
            padding: 30px;
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            min-height: 80vh;
        }

        .dashboard-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--light-bg);
        }

        .welcome-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 25px;
        }

        .welcome-message h1 {
            color: var(--primary-text);
            margin: 0 0 10px 0;
            font-size: 2rem;
        }

        .welcome-message p {
            color: var(--secondary-text);
            margin: 0;
            font-size: 1.1rem;
        }

        .welcome-message .user-name {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .dashboard-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            border: none;
        }

        .quick-action-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .quick-action-btn.primary:hover {
            background: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .quick-action-btn.secondary {
            background: white;
            color: var(--primary-text);
            border: 2px solid var(--accent-blue);
        }

        .quick-action-btn.secondary:hover {
            background: var(--light-bg);
            transform: translateY(-2px);
        }

        /* Dashboard Layout */
        .dashboard-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        @media (max-width: 992px) {
            .dashboard-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Sidebar Navigation */
        .dashboard-sidebar {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            padding: 25px;
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .user-profile-card {
            text-align: center;
            padding-bottom: 25px;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--light-bg);
        }

        .user-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .user-avatar:hover {
            transform: scale(1.05);
        }

        .user-profile-card h3 {
            color: var(--primary-text);
            margin: 0 0 5px 0;
        }

        .user-profile-card p {
            color: var(--secondary-text);
            margin: 0 0 15px 0;
            font-size: 0.9rem;
        }

        .account-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .account-status.verified {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .account-status.pending {
            background: #fff3e0;
            color: #f57c00;
        }

        .account-status.unverified {
            background: #ffebee;
            color: #c62828;
        }

        /* Sidebar Navigation */
        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            color: var(--secondary-text);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-item:hover {
            background: var(--light-bg);
            color: var(--primary-blue);
        }

        .nav-item.active {
            background: var(--primary-blue);
            color: white;
        }

        .nav-item.active i {
            color: white;
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            color: var(--accent-blue);
        }

        .nav-badge {
            margin-left: auto;
            background: var(--accent-blue);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        /* Dashboard Content */
        .dashboard-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .dashboard-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            padding: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light-bg);
        }

        .section-header h2 {
            color: var(--primary-text);
            margin: 0;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-header h2 i {
            color: var(--primary-blue);
        }

        .view-all-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-all-link:hover {
            text-decoration: underline;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-text);
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Profile Form */
        .profile-form {
            max-width: 800px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-save {
            background: var(--primary-blue);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn-save:hover {
            background: var(--accent-blue);
        }

        .btn-cancel {
            background: white;
            color: var(--primary-text);
            padding: 12px 30px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-cancel:hover {
            background: var(--light-bg);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-blue);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 20px;
            color: var(--primary-blue);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-text);
            margin-bottom: 5px;
            line-height: 1;
        }

        .stat-label {
            color: var(--secondary-text);
            font-size: 0.95rem;
            margin: 0;
        }

        /* Orders Table */
        .orders-table {
            width: 100%;
            border-collapse: collapse;
        }

        .orders-table th {
            text-align: left;
            padding: 15px;
            background: var(--light-bg);
            color: var(--primary-text);
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }

        .orders-table td {
            padding: 15px;
            border-bottom: 1px solid var(--light-bg);
            color: var(--secondary-text);
        }

        .orders-table tr:hover {
            background: #f9f9f9;
        }

        .order-status {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-processing {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-shipped {
            background: #e3f2fd;
            color: var(--primary-blue);
        }

        .status-delivered {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-cancelled {
            background: #ffebee;
            color: #c62828;
        }

        .order-actions {
            display: flex;
            gap: 10px;
        }

        .order-action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .order-action-btn.track {
            background: var(--light-bg);
            color: var(--primary-blue);
        }

        .order-action-btn.track:hover {
            background: var(--primary-blue);
            color: white;
        }

        .order-action-btn.view {
            background: white;
            color: var(--primary-text);
            border: 1px solid var(--border-color);
        }

        .order-action-btn.view:hover {
            background: var(--light-bg);
        }

        /* Service Appointments */
        .appointments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .appointment-card {
            border: 2px solid var(--light-bg);
            border-radius: 10px;
            padding: 20px;
            transition: all 0.2s;
        }

        .appointment-card:hover {
            border-color: var(--accent-blue);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .appointment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .appointment-title {
            color: var(--primary-text);
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }

        .appointment-date {
            color: var(--secondary-text);
            font-size: 0.9rem;
            margin: 0;
        }

        .appointment-status {
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .appointment-details {
            margin: 15px 0;
        }

        .appointment-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        .appointment-detail i {
            color: var(--accent-blue);
            width: 16px;
        }

        .appointment-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .appointment-action-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .appointment-action-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .appointment-action-btn.primary:hover {
            background: var(--accent-blue);
        }

        .appointment-action-btn.secondary {
            background: white;
            color: var(--primary-text);
            border: 1px solid var(--border-color);
        }

        .appointment-action-btn.secondary:hover {
            background: var(--light-bg);
        }

        /* Wishlist Items */
        .wishlist-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .wishlist-item {
            border: 1px solid var(--light-bg);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .wishlist-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .wishlist-image {
            height: 150px;
            background: var(--light-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-blue);
            font-size: 40px;
        }

        .wishlist-details {
            padding: 15px;
        }

        .wishlist-title {
            color: var(--primary-text);
            margin: 0 0 10px 0;
            font-size: 1rem;
            line-height: 1.4;
        }

        .wishlist-price {
            font-weight: 600;
            color: var(--primary-text);
            margin-bottom: 10px;
        }

        .wishlist-actions {
            display: flex;
            gap: 10px;
        }

        .wishlist-action-btn {
            flex: 1;
            padding: 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            border: none;
            cursor: pointer;
        }

        .wishlist-action-btn.add-to-cart {
            background: var(--primary-blue);
            color: white;
        }

        .wishlist-action-btn.add-to-cart:hover {
            background: var(--accent-blue);
        }

        .wishlist-action-btn.remove {
            background: white;
            color: var(--primary-text);
            border: 1px solid var(--border-color);
        }

        .wishlist-action-btn.remove:hover {
            background: #ffebee;
            color: #f44336;
            border-color: #f44336;
        }

        /* Recent Activity */
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .activity-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
            background: #f9f9f9;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-size: 16px;
            flex-shrink: 0;
        }

        .activity-content {
            flex: 1;
        }

        .activity-text {
            color: var(--primary-text);
            margin: 0 0 5px 0;
            line-height: 1.4;
        }

        .activity-time {
            color: var(--secondary-text);
            font-size: 0.85rem;
            margin: 0;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--secondary-text);
        }

        .empty-state i {
            font-size: 48px;
            color: var(--light-bg);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            color: var(--primary-text);
            margin: 0 0 10px 0;
        }

        .empty-state p {
            margin: 0 0 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Address Book */
        .address-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .address-card {
            border: 2px solid var(--light-bg);
            border-radius: 10px;
            padding: 20px;
            position: relative;
        }

        .address-card.default {
            border-color: var(--primary-blue);
        }

        .address-type {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary-blue);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .address-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Payment Methods */
        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .payment-method {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .payment-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .payment-icon {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-blue);
            font-size: 20px;
        }

        /* Security Settings */
        .security-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .security-info h4 {
            margin: 0 0 5px 0;
            color: var(--primary-text);
        }

        .security-info p {
            margin: 0;
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-blue);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Notification Settings */
        .notification-category {
            margin-bottom: 30px;
        }

        .notification-category h4 {
            color: var(--primary-text);
            margin: 0 0 15px 0;
        }

        .notification-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        /* Loading States */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary-text);
        }

        /* Success/Error Messages */
        .alert-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }

        .alert-error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }

        .alert-info {
            background: #e3f2fd;
            color: var(--primary-blue);
            border: 1px solid #bbdefb;
        }

        .alert-warning {
            background: #fff3e0;
            color: #f57c00;
            border: 1px solid #ffe0b2;
        }

        /* Footer */
        .main-footer {
            background: white;
            border-top: 1px solid var(--border-color);
            padding: 40px 30px 20px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h4 {
            color: var(--primary-text);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .footer-section p {
            color: var(--secondary-text);
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--secondary-text);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: var(--primary-blue);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            color: var(--secondary-text);
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-nav {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .search-bar-top {
                min-width: 200px;
            }
        }

        @media (max-width: 768px) {
            .header-top-row {
                padding: 15px 20px;
                flex-wrap: wrap;
                gap: 15px;
            }
            
            .logo-and-nav {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-and-actions {
                width: 100%;
                justify-content: space-between;
            }
            
            .search-bar-top {
                flex: 1;
                min-width: auto;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .dashboard-container {
                padding: 0;
            }
            
            .welcome-section {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .dashboard-actions {
                width: 100%;
            }
            
            .quick-action-btn {
                flex: 1;
                justify-content: center;
                min-width: 150px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .orders-table {
                display: block;
                overflow-x: auto;
            }
            
            .appointments-grid,
            .wishlist-grid,
            .address-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-section {
                padding: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .modal-content {
                width: 95%;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                text-align: left;
                display: flex;
                align-items: center;
                gap: 20px;
            }
            
            .stat-icon {
                margin: 0;
            }
            
            .order-actions,
            .appointment-actions,
            .wishlist-actions,
            .form-actions {
                flex-direction: column;
            }
            
            .modal-body {
                padding: 15px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
            
            .btn-save, .btn-cancel {
                width: 100%;
            }
        }

        /* Authentication Required Overlay */
        .auth-required-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            z-index: 4000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }

        .auth-required-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .auth-required-content {
            max-width: 400px;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .auth-required-icon {
            font-size: 48px;
            color: var(--primary-blue);
            margin-bottom: 20px;
        }

        .auth-required-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        /* Session Expired Warning */
        .session-warning {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--warning);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 5000;
            display: none;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .session-warning.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Authentication Required Overlay -->
    <div class="auth-required-overlay" id="auth-required-overlay">
        <div class="auth-required-content">
            <div class="auth-required-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h2>Authentication Required</h2>
            <p>You need to be logged in to access your dashboard. Please log in or create an account.</p>
            <div class="auth-required-actions">
                <button class="btn-save" onclick="window.location.href='login.html'">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                <button class="btn-cancel" onclick="window.location.href='register.html'">
                    <i class="fas fa-user-plus"></i> Register
                </button>
            </div>
        </div>
    </div>

    <!-- Session Expired Warning -->
    <div class="session-warning" id="session-warning">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <strong>Session Expiring Soon</strong>
                <p style="margin: 5px 0 0 0; font-size: 0.9rem;">Your session will expire in <span id="session-countdown">5:00</span></p>
            </div>
            <button onclick="refreshSession()" style="margin-left: 15px; padding: 5px 15px; background: white; color: var(--warning); border: none; border-radius: 4px; cursor: pointer;">
                Refresh
            </button>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="header-top-row">
            <div class="logo-and-nav">
                <div class="logo">XS</div>
                <div class="slogan">Electronics Shop & Repair Services Kenya</div>
                <nav class="main-nav">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="products.html" class="nav-link">Products</a> 
                    <a href="services.html" class="nav-link">Services <span class="badge-new">NEW</span></a>
                    <a href="deals.html" class="nav-link">Deals</a>
                    <a href="support.html" class="nav-link">Support</a>
                </nav>
            </div>

            <div class="search-and-actions">
                <div class="search-bar-top">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search products, services, or brands..." class="search-input" id="global-search">
                </div>

                <div class="auth-state">
                    <div class="logged-in-state" id="logged-in-state">
                        <div class="user-profile">
                            <button class="user-menu-btn" id="user-menu-btn" aria-label="Open account menu">
                                <i class="fas fa-user-circle"></i>
                                <span id="user-menu-name">Loading...</span>
                            </button>
                            <div class="user-dropdown" id="user-dropdown">
                                <a href="#" class="dropdown-item" onclick="dashboard.switchTab('overview')">
                                    <i class="fas fa-tachometer-alt"></i> Dashboard
                                </a>
                                <a href="#" class="dropdown-item" onclick="dashboard.switchTab('profile')">
                                    <i class="fas fa-user"></i> My Profile
                                </a>
                                <a href="#" class="dropdown-item" onclick="dashboard.switchTab('orders')">
                                    <i class="fas fa-box"></i> My Orders
                                </a>
                                <a href="#" class="dropdown-item" onclick="dashboard.switchTab('wishlist')">
                                    <i class="fas fa-heart"></i> Wishlist
                                </a>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item logout-btn" id="logout-btn">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn-wishlist" id="wishlist-btn" onclick="dashboard.switchTab('wishlist')">
                    <i class="fas fa-heart"></i> 
                    <span class="wishlist-count" id="header-wishlist-count">0</span>
                </button>
                
                <button class="btn-submit" id="cart-btn" onclick="window.location.href='cart.html'">
                    <i class="fas fa-shopping-cart"></i> Cart <span class="cart-count" id="header-cart-count">0</span>
                </button>
                
                <button class="mobile-menu-btn" id="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu Panel -->
        <div class="mobile-menu-panel" id="mobile-menu-panel">
            <div class="mobile-menu-header">
                <div class="mobile-logo">XS</div>
                <button class="mobile-menu-close" id="mobile-menu-close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="mobile-menu-content">
                <div class="mobile-auth-state">
                    <div class="mobile-logged-in-state" id="mobile-logged-in-state">
                        <div class="mobile-user-info">
                            <div class="mobile-user-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="mobile-user-details">
                                <div class="mobile-user-name" id="mobile-user-name">Loading...</div>
                                <div class="mobile-user-email" id="mobile-user-email">Loading...</div>
                            </div>
                        </div>
                        
                        <div class="mobile-user-menu">
                            <a href="#" class="mobile-nav-link" onclick="dashboard.switchTab('overview'); closeMobileMenu();">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                            <a href="#" class="mobile-nav-link" onclick="dashboard.switchTab('profile'); closeMobileMenu();">
                                <i class="fas fa-user"></i> My Profile
                            </a>
                            <a href="#" class="mobile-nav-link" onclick="dashboard.switchTab('orders'); closeMobileMenu();">
                                <i class="fas fa-box"></i> My Orders
                            </a>
                            <a href="#" class="mobile-nav-link" onclick="dashboard.switchTab('wishlist'); closeMobileMenu();">
                                <i class="fas fa-heart"></i> Wishlist
                            </a>
                            <div class="mobile-menu-divider"></div>
                            <button class="mobile-action-btn logout" id="mobile-logout-btn">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mobile-nav-section">
                    <a href="index.html" class="mobile-nav-link" onclick="closeMobileMenu();">
                        <i class="fas fa-home"></i> Home
                    </a>
                    <a href="products.html" class="mobile-nav-link" onclick="closeMobileMenu();">
                        <i class="fas fa-shopping-bag"></i> Products
                    </a>
                    <a href="services.html" class="mobile-nav-link" onclick="closeMobileMenu();">
                        <i class="fas fa-tools"></i> Services <span class="mobile-badge-new">NEW</span>
                    </a>
                    <a href="deals.html" class="mobile-nav-link" onclick="closeMobileMenu();">
                        <i class="fas fa-tag"></i> Deals
                    </a>
                    <a href="support.html" class="mobile-nav-link" onclick="closeMobileMenu();">
                        <i class="fas fa-headset"></i> Support
                    </a>
                </div>
                
                <div class="mobile-actions-section">
                    <button class="mobile-action-btn" onclick="dashboard.switchTab('wishlist'); closeMobileMenu();">
                        <i class="fas fa-heart"></i> Wishlist <span class="mobile-wishlist-count" id="mobile-wishlist-count">0</span>
                    </button>
                    <button class="mobile-action-btn" onclick="window.location.href='cart.html'; closeMobileMenu();">
                        <i class="fas fa-shopping-cart"></i> Cart <span class="mobile-cart-count" id="mobile-cart-count">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard-container">
            <!-- Alert Area -->
            <div id="alert-area"></div>

            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="welcome-section">
                    <div class="welcome-message">
                        <h1>Welcome back, <span class="user-name" id="welcome-name">User</span>! </h1>
                        <p id="dashboard-subtitle">Manage your account, orders, and preferences.</p>
                    </div>
                    
                    <div class="dashboard-actions">
                        <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                            <i class="fas fa-shopping-bag"></i> Shop Now
                        </button>
                        <button class="quick-action-btn secondary" onclick="window.location.href='booking-form.html'">
                            <i class="fas fa-tools"></i> Book Service
                        </button>
                        <button class="quick-action-btn secondary" onclick="window.location.href='support.html'">
                            <i class="fas fa-headset"></i> Get Support
                        </button>
                    </div>
                </div>
            </div>

            <!-- Dashboard Layout -->
            <div class="dashboard-layout">
                <!-- Sidebar Navigation -->
                <div class="dashboard-sidebar">
                    <!-- User Profile Card -->
                    <div class="user-profile-card">
                        <div class="user-avatar" id="user-avatar">
                            <span>U</span>
                        </div>
                        <h3 id="profile-name">Loading...</h3>
                        <p id="profile-email">Loading...</p>
                        <span class="account-status verified" id="account-status">Verified Account</span>
                    </div>

                    <!-- Navigation Menu -->
                    <nav class="sidebar-nav">
                        <button class="nav-item active" data-tab="overview" onclick="dashboard.switchTab('overview')">
                            <i class="fas fa-tachometer-alt"></i>
                            Dashboard Overview
                        </button>
                        
                        <button class="nav-item" data-tab="profile" onclick="dashboard.switchTab('profile')">
                            <i class="fas fa-user"></i>
                            Profile Settings
                        </button>
                        
                        <button class="nav-item" data-tab="orders" onclick="dashboard.switchTab('orders')">
                            <i class="fas fa-shopping-bag"></i>
                            My Orders
                            <span class="nav-badge" id="orders-count">0</span>
                        </button>
                        
                        <button class="nav-item" data-tab="appointments" onclick="dashboard.switchTab('appointments')">
                            <i class="fas fa-calendar-alt"></i>
                            Service Appointments
                            <span class="nav-badge" id="appointments-count">0</span>
                        </button>
                        
                        <button class="nav-item" data-tab="wishlist" onclick="dashboard.switchTab('wishlist')">
                            <i class="fas fa-heart"></i>
                            Wishlist
                            <span class="nav-badge" id="wishlist-count">0</span>
                        </button>
                        
                        <button class="nav-item" data-tab="addresses" onclick="dashboard.switchTab('addresses')">
                            <i class="fas fa-map-marker-alt"></i>
                            Saved Addresses
                        </button>
                        
                        <button class="nav-item" data-tab="payment" onclick="dashboard.switchTab('payment')">
                            <i class="fas fa-credit-card"></i>
                            Payment Methods
                        </button>
                        
                        <button class="nav-item" data-tab="security" onclick="dashboard.switchTab('security')">
                            <i class="fas fa-shield-alt"></i>
                            Security
                        </button>
                        
                        <button class="nav-item" data-tab="notifications" onclick="dashboard.switchTab('notifications')">
                            <i class="fas fa-bell"></i>
                            Notifications
                        </button>
                        
                        <button class="nav-item" data-tab="support" onclick="dashboard.switchTab('support')">
                            <i class="fas fa-headset"></i>
                            Support Tickets
                        </button>
                    </nav>
                </div>

                <!-- Dashboard Content -->
                <div class="dashboard-content">
                    <!-- Overview Tab (Default) -->
                    <div class="tab-content active" id="overview-tab">
                        <!-- Loading State -->
                        <div id="overview-loading" class="dashboard-section">
                            <div class="empty-state">
                                <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                <h3>Loading Dashboard...</h3>
                                <p>Please wait while we load your dashboard data</p>
                            </div>
                        </div>
                        
                        <!-- Stats Overview -->
                        <div class="dashboard-section" id="stats-section" style="display: none;">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-shopping-bag"></i>
                                    </div>
                                    <div class="stat-value" id="total-orders">0</div>
                                    <div class="stat-label">Total Orders</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-tools"></i>
                                    </div>
                                    <div class="stat-value" id="total-services">0</div>
                                    <div class="stat-label">Services Booked</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-wallet"></i>
                                    </div>
                                    <div class="stat-value" id="total-spent">$0</div>
                                    <div class="stat-label">Total Spent</div>
                                </div>
                                
                                <div class="stat-card">
                                    <div class="stat-icon">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div class="stat-value" id="member-since">0</div>
                                    <div class="stat-label">Months as Member</div>
                                </div>
                            </div>
                        </div>

                        <!-- Recent Orders -->
                        <div class="dashboard-section" id="recent-orders-section" style="display: none;">
                            <div class="section-header">
                                <h2><i class="fas fa-history"></i> Recent Orders</h2>
                                <a href="#" class="view-all-link" onclick="dashboard.switchTab('orders')">
                                    View All <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="orders-table" id="recent-orders-table">
                                    <thead>
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Date</th>
                                            <th>Items</th>
                                            <th>Total</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recent-orders-body">
                                        <!-- Orders loaded dynamically -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div id="no-recent-orders" class="empty-state" style="display: none;">
                                <i class="fas fa-shopping-bag"></i>
                                <h3>No Orders Yet</h3>
                                <p>You haven't placed any orders yet. Start shopping to see your orders here.</p>
                                <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                                    Start Shopping
                                </button>
                            </div>
                        </div>

                        <!-- Upcoming Appointments -->
                        <div class="dashboard-section" id="appointments-section" style="display: none;">
                            <div class="section-header">
                                <h2><i class="fas fa-calendar-alt"></i> Upcoming Appointments</h2>
                                <a href="#" class="view-all-link" onclick="dashboard.switchTab('appointments')">
                                    View All <i class="fas fa-arrow-right"></i>
                                </a>
                            </div>
                            
                            <div class="appointments-grid" id="upcoming-appointments">
                                <!-- Appointments loaded dynamically -->
                            </div>
                            
                            <div id="no-appointments" class="empty-state" style="display: none;">
                                <i class="fas fa-calendar-alt"></i>
                                <h3>No Upcoming Appointments</h3>
                                <p>You don't have any scheduled service appointments.</p>
                                <button class="quick-action-btn primary" onclick="window.location.href='booking-form.html'">
                                    Book a Service
                                </button>
                            </div>
                        </div>

                        <!-- Recent Activity -->
                        <div class="dashboard-section" id="activity-section" style="display: none;">
                            <div class="section-header">
                                <h2><i class="fas fa-history"></i> Recent Activity</h2>
                            </div>
                            
                            <div class="activity-list" id="recent-activity">
                                <!-- Activity loaded dynamically -->
                            </div>
                            
                            <div id="no-activity" class="empty-state" style="display: none;">
                                <i class="fas fa-history"></i>
                                <h3>No Recent Activity</h3>
                                <p>Your recent activity will appear here.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Tab -->
                    <div class="tab-content" id="profile-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-user"></i> Profile Settings</h2>
                            </div>
                            
                            <div id="profile-loading">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Profile...</h3>
                                </div>
                            </div>
                            
                            <form id="profile-form" class="profile-form" style="display: none;">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-label" for="first-name">First Name *</label>
                                        <input type="text" id="first-name" class="form-control" required>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="last-name">Last Name *</label>
                                        <input type="text" id="last-name" class="form-control" required>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="email">Email Address *</label>
                                    <input type="email" id="profile-email" class="form-control" required disabled>
                                    <small style="color: var(--secondary-text);">Email cannot be changed</small>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="phone">Phone Number</label>
                                    <input type="tel" id="profile-phone" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" for="date-of-birth">Date of Birth</label>
                                    <input type="date" id="date-of-birth" class="form-control">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Account Type</label>
                                    <div style="display: flex; gap: 20px; margin-top: 10px;">
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="account-type" value="personal" checked> Personal Account
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="radio" name="account-type" value="business"> Business Account
                                        </label>
                                    </div>
                                </div>
                                
                                <div id="business-fields" style="display: none;">
                                    <div class="form-group">
                                        <label class="form-label" for="company-name">Company Name</label>
                                        <input type="text" id="company-name" class="form-control">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label" for="tax-id">Tax ID / VAT Number</label>
                                        <input type="text" id="tax-id" class="form-control">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Communication Preferences</label>
                                    <div style="margin-top: 10px;">
                                        <label style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                            <input type="checkbox" id="email-marketing"> Receive promotional emails
                                        </label>
                                        <label style="display: flex; align-items: center; gap: 8px;">
                                            <input type="checkbox" id="sms-notifications"> Receive SMS notifications
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button type="submit" class="btn-save" id="save-profile">
                                        <span id="save-text">Save Changes</span>
                                        <span id="save-spinner" class="loading-spinner" style="display: none;"></span>
                                    </button>
                                    <button type="button" class="btn-cancel" onclick="dashboard.loadProfileData()">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div class="tab-content" id="orders-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-shopping-bag"></i> My Orders</h2>
                                <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                                    Continue Shopping
                                </button>
                            </div>
                            
                            <div id="orders-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Orders...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Appointments Tab -->
                    <div class="tab-content" id="appointments-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-calendar-alt"></i> Service Appointments</h2>
                                <button class="quick-action-btn primary" onclick="window.location.href='booking-form.html'">
                                    <i class="fas fa-plus"></i> Book New Service
                                </button>
                            </div>
                            
                            <div id="appointments-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Appointments...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wishlist Tab -->
                    <div class="tab-content" id="wishlist-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-heart"></i> My Wishlist</h2>
                                <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                                    Continue Shopping
                                </button>
                            </div>
                            
                            <div id="wishlist-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Wishlist...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Addresses Tab -->
                    <div class="tab-content" id="addresses-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-map-marker-alt"></i> Saved Addresses</h2>
                                <button class="quick-action-btn primary" onclick="dashboard.showAddressModal()">
                                    <i class="fas fa-plus"></i> Add New Address
                                </button>
                            </div>
                            
                            <div id="addresses-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Addresses...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Methods Tab -->
                    <div class="tab-content" id="payment-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-credit-card"></i> Payment Methods</h2>
                                <button class="quick-action-btn primary" onclick="dashboard.showPaymentModal()">
                                    <i class="fas fa-plus"></i> Add Payment Method
                                </button>
                            </div>
                            
                            <div id="payment-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Payment Methods...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Tab -->
                    <div class="tab-content" id="security-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-shield-alt"></i> Security Settings</h2>
                            </div>
                            
                            <div id="security-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Security Settings...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notifications Tab -->
                    <div class="tab-content" id="notifications-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
                            </div>
                            
                            <div id="notifications-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Notification Settings...</h3>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Support Tickets Tab -->
                    <div class="tab-content" id="support-tab">
                        <div class="dashboard-section">
                            <div class="section-header">
                                <h2><i class="fas fa-headset"></i> Support Tickets</h2>
                                <button class="quick-action-btn primary" onclick="window.location.href='support.html'">
                                    <i class="fas fa-plus"></i> New Ticket
                                </button>
                            </div>
                            
                            <div id="support-content">
                                <div class="empty-state">
                                    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto 20px;"></div>
                                    <h3>Loading Support Tickets...</h3>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modals -->
    <div id="address-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;">Add New Address</h3>
                <button class="modal-close" onclick="dashboard.closeModal('address-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="address-form">
                    <div class="form-group">
                        <label class="form-label" for="address-name">Address Name *</label>
                        <input type="text" id="address-name" class="form-control" placeholder="Home, Work, etc." required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="full-name">Full Name *</label>
                        <input type="text" id="full-name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="street-address">Street Address *</label>
                        <input type="text" id="street-address" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="apartment">Apartment, Suite, etc.</label>
                        <input type="text" id="apartment" class="form-control">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="city">City *</label>
                            <input type="text" id="city" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="state">State/Province *</label>
                            <input type="text" id="state" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="zip-code">ZIP/Postal Code *</label>
                            <input type="text" id="zip-code" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="country">Country *</label>
                            <select id="country" class="form-control" required>
                                <option value="">Select Country</option>
                                <option value="KE" selected>Kenya</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                                <option value="UK">United Kingdom</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="phone">Phone Number *</label>
                        <input type="tel" id="phone-number" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="set-default-address"> Set as default address
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="dashboard.closeModal('address-modal')">Cancel</button>
                <button class="btn-save" onclick="dashboard.saveAddress()">Save Address</button>
            </div>
        </div>
    </div>

    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;">Add Payment Method</h3>
                <button class="modal-close" onclick="dashboard.closeModal('payment-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="payment-form">
                    <div class="form-group">
                        <label class="form-label">Card Type</label>
                        <div style="display: flex; gap: 15px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="radio" name="card-type" value="visa" checked> 
                                <i class="fab fa-cc-visa" style="font-size: 24px; color: #1a1f71;"></i> Visa
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="radio" name="card-type" value="mastercard">
                                <i class="fab fa-cc-mastercard" style="font-size: 24px; color: #eb001b;"></i> Mastercard
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="radio" name="card-type" value="amex">
                                <i class="fab fa-cc-amex" style="font-size: 24px; color: #2e77bc;"></i> Amex
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="card-name">Name on Card *</label>
                        <input type="text" id="card-name" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="card-number">Card Number *</label>
                        <input type="text" id="card-number" class="form-control" pattern="[0-9]{16}" maxlength="16" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="expiry-date">Expiry Date *</label>
                            <input type="month" id="expiry-date" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="cvv">CVV *</label>
                            <input type="text" id="cvv" class="form-control" pattern="[0-9]{3,4}" maxlength="4" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="set-default-payment"> Set as default payment method
                        </label>
                    </div>
                    
                    <div class="alert-message alert-info">
                        <i class="fas fa-lock"></i>
                        <span>Your payment information is securely encrypted</span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="dashboard.closeModal('payment-modal')">Cancel</button>
                <button class="btn-save" onclick="dashboard.savePaymentMethod()">Add Card</button>
            </div>
        </div>
    </div>

    <div id="change-password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;">Change Password</h3>
                <button class="modal-close" onclick="dashboard.closeModal('change-password-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="change-password-form">
                    <div class="form-group">
                        <label class="form-label" for="current-password">Current Password *</label>
                        <input type="password" id="current-password" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="new-password">New Password *</label>
                        <input type="password" id="new-password" class="form-control" required>
                        <small style="color: var(--secondary-text);">Minimum 8 characters with letters and numbers</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="confirm-password">Confirm New Password *</label>
                        <input type="password" id="confirm-password" class="form-control" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="dashboard.closeModal('change-password-modal')">Cancel</button>
                <button class="btn-save" onclick="dashboard.changePassword()">Change Password</button>
            </div>
        </div>
    </div>

    <div id="delete-account-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0; color: var(--error);">Delete Account</h3>
                <button class="modal-close" onclick="dashboard.closeModal('delete-account-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="alert-message alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span><strong>Warning:</strong> This action cannot be undone</span>
                </div>
                <p>Are you sure you want to delete your account? This will:</p>
                <ul style="margin: 15px 0 15px 20px; color: var(--secondary-text);">
                    <li>Permanently delete all your personal data</li>
                    <li>Cancel all pending orders and appointments</li>
                    <li>Remove your wishlist and saved addresses</li>
                    <li>Delete your payment methods</li>
                </ul>
                <p>To confirm deletion, please enter your password:</p>
                <div class="form-group">
                    <label class="form-label" for="delete-password">Password *</label>
                    <input type="password" id="delete-password" class="form-control" required>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="dashboard.closeModal('delete-account-modal')">Cancel</button>
                <button class="btn-save" style="background: var(--error);" onclick="dashboard.deleteAccount()">Delete Account</button>
            </div>
        </div>
    </div>

    <div id="two-factor-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="margin: 0;">Two-Factor Authentication</h3>
                <button class="modal-close" onclick="dashboard.closeModal('two-factor-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: var(--secondary-text);">
                    Two-factor authentication adds an extra layer of security to your account.
                    You'll need to enter a code from your authentication app when logging in.
                </p>
                <div id="two-factor-setup" style="display: none;">
                    <div class="form-group">
                        <label class="form-label">Scan QR Code</label>
                        <div style="text-align: center; margin: 20px 0;">
                            <div id="qr-code" style="width: 200px; height: 200px; background: #f5f5f5; margin: 0 auto; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                                <i class="fas fa-qrcode" style="font-size: 48px; color: var(--secondary-text);"></i>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Or enter this code manually:</label>
                        <div style="background: var(--light-bg); padding: 15px; border-radius: 8px; font-family: monospace; font-size: 1.2rem; text-align: center; letter-spacing: 2px;">
                            <span id="two-factor-secret">XXXX-XXXX-XXXX-XXXX</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="two-factor-code">Enter verification code *</label>
                        <input type="text" id="two-factor-code" class="form-control" placeholder="000000" maxlength="6" required>
                        <small style="color: var(--secondary-text);">Enter the 6-digit code from your authentication app</small>
                    </div>
                </div>
                <div id="two-factor-status">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; justify-content: space-between;">
                            <span>Two-Factor Authentication</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="two-factor-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="dashboard.closeModal('two-factor-modal')">Cancel</button>
                <button class="btn-save" id="two-factor-save" onclick="dashboard.saveTwoFactor()">Enable 2FA</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>XS Platform Kenya</h4>
                <p>Your trusted source for electronics and repair services in Kenya since 2024.</p>
                <div style="display: flex; gap: 15px; margin-top: 15px;">
                    <a href="#" style="color: var(--primary-blue);"><i class="fab fa-facebook"></i></a>
                    <a href="#" style="color: var(--primary-blue);"><i class="fab fa-twitter"></i></a>
                    <a href="#" style="color: var(--primary-blue);"><i class="fab fa-instagram"></i></a>
                    <a href="#" style="color: var(--primary-blue);"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            
            <div class="footer-section">
                <h4>Quick Links</h4>
                <ul class="footer-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="deals.html">Deals</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>Account</h4>
                <ul class="footer-links">
                    <li><a href="#" onclick="dashboard.switchTab('overview')">My Dashboard</a></li>
                    <li><a href="#" onclick="dashboard.switchTab('profile')">My Profile</a></li>
                    <li><a href="#" onclick="dashboard.switchTab('orders')">Order History</a></li>
                    <li><a href="#" onclick="dashboard.switchTab('wishlist')">Wishlist</a></li>
                </ul>
            </div>
            
            <div class="footer-section">
                <h4>Support</h4>
                <ul class="footer-links">
                    <li><a href="support.html">Help Center</a></li>
                    <li><a href="#" onclick="dashboard.switchTab('support')">My Tickets</a></li>
                    <li><a href="contact.html">Contact Us</a></li>
                    <li><a href="faq.html">FAQ</a></li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            &copy; 2024 XS Platform Kenya. All rights reserved. | 
            <a href="privacy-policy.html" style="color: var(--secondary-text);">Privacy Policy</a> | 
            <a href="terms.html" style="color: var(--secondary-text);">Terms of Service</a>
        </div>
    </footer>

    <script>
        // API Configuration - Shared with login and register pages
        const API_CONFIG = {
            BASE_URL: 'http://localhost:5000/api',
            
            ENDPOINTS: {
                // Authentication
                VALIDATE_TOKEN: '/auth/validate-token',
                REFRESH_TOKEN: '/auth/refresh-token',
                CUSTOMER_LOGOUT: '/auth/customer/logout',
                CHANGE_PASSWORD: '/auth/change-password',
                DELETE_ACCOUNT: '/auth/delete-account',
                
                // Two-Factor Authentication
                ENABLE_2FA: '/auth/enable-2fa',
                DISABLE_2FA: '/auth/disable-2fa',
                VERIFY_2FA_SETUP: '/auth/verify-2fa-setup',
                GENERATE_2FA_SECRET: '/auth/generate-2fa-secret',
                
                // User Profile
                GET_PROFILE: '/customer/profile',
                UPDATE_PROFILE: '/customer/profile',
                UPDATE_PREFERENCES: '/customer/preferences',
                
                // Orders
                GET_ORDERS: '/orders',
                GET_ORDER_DETAILS: '/orders/:id',
                GET_RECENT_ORDERS: '/orders/recent',
                GET_ORDER_COUNT: '/orders/count',
                TRACK_ORDER: '/orders/:id/track',
                CANCEL_ORDER: '/orders/:id/cancel',
                REORDER: '/orders/:id/reorder',
                
                // Appointments
                GET_APPOINTMENTS: '/appointments',
                GET_UPCOMING_APPOINTMENTS: '/appointments/upcoming',
                GET_APPOINTMENT_DETAILS: '/appointments/:id',
                CREATE_APPOINTMENT: '/appointments',
                UPDATE_APPOINTMENT: '/appointments/:id',
                CANCEL_APPOINTMENT: '/appointments/:id/cancel',
                RESCHEDULE_APPOINTMENT: '/appointments/:id/reschedule',
                GET_APPOINTMENT_COUNT: '/appointments/count',
                
                // Wishlist
                GET_WISHLIST: '/wishlist',
                ADD_TO_WISHLIST: '/wishlist',
                REMOVE_FROM_WISHLIST: '/wishlist/:id',
                MOVE_TO_CART: '/wishlist/:id/move-to-cart',
                GET_WISHLIST_COUNT: '/wishlist/count',
                
                // Addresses
                GET_ADDRESSES: '/addresses',
                GET_ADDRESS: '/addresses/:id',
                CREATE_ADDRESS: '/addresses',
                UPDATE_ADDRESS: '/addresses/:id',
                DELETE_ADDRESS: '/addresses/:id',
                SET_DEFAULT_ADDRESS: '/addresses/:id/default',
                
                // Payment Methods
                GET_PAYMENT_METHODS: '/payment-methods',
                GET_PAYMENT_METHOD: '/payment-methods/:id',
                CREATE_PAYMENT_METHOD: '/payment-methods',
                UPDATE_PAYMENT_METHOD: '/payment-methods/:id',
                DELETE_PAYMENT_METHOD: '/payment-methods/:id',
                SET_DEFAULT_PAYMENT: '/payment-methods/:id/default',
                
                // Notifications
                GET_NOTIFICATIONS: '/notifications',
                GET_NOTIFICATION_SETTINGS: '/notifications/settings',
                UPDATE_NOTIFICATION_SETTINGS: '/notifications/settings',
                MARK_NOTIFICATION_READ: '/notifications/:id/read',
                DELETE_NOTIFICATION: '/notifications/:id',
                GET_UNREAD_COUNT: '/notifications/unread-count',
                
                // Support Tickets
                GET_TICKETS: '/support/tickets',
                GET_TICKET: '/support/tickets/:id',
                CREATE_TICKET: '/support/tickets',
                UPDATE_TICKET: '/support/tickets/:id',
                CLOSE_TICKET: '/support/tickets/:id/close',
                GET_TICKET_COUNT: '/support/tickets/count',
                
                // Dashboard Stats
                GET_DASHBOARD_STATS: '/dashboard/stats',
                GET_RECENT_ACTIVITY: '/dashboard/activity',
                GET_COUNTS: '/dashboard/counts',
                
                // Cart
                GET_CART_COUNT: '/cart/count',
                
                // Products
                GET_PRODUCT: '/products/:id'
            },
            
            HEADERS: {
                'Content-Type': 'application/json',
                'Accept': 'application/json',
                'X-Platform': 'web',
                'X-Country-Code': 'KE'
            },
            
            TOKEN_CONFIG: {
                ACCESS_TOKEN_KEY: 'xs_access_token',
                REFRESH_TOKEN_KEY: 'xs_refresh_token',
                USER_DATA_KEY: 'xs_user_data',
                TOKEN_EXPIRY_KEY: 'xs_token_expiry',
                REMEMBER_ME_KEY: 'xs_remember_me',
                SESSION_TIMESTAMP: 'xs_session_timestamp'
            }
        };

        // Token Manager (shared with login)
        class TokenManager {
            static getAccessToken() {
                const rememberMe = localStorage.getItem(API_CONFIG.TOKEN_CONFIG.REMEMBER_ME_KEY) === 'true';
                return rememberMe 
                    ? localStorage.getItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY)
                    : sessionStorage.getItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY);
            }
            
            static setAccessToken(token, rememberMe = false) {
                if (rememberMe) {
                    localStorage.setItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY, token);
                    localStorage.setItem(API_CONFIG.TOKEN_CONFIG.REMEMBER_ME_KEY, 'true');
                } else {
                    sessionStorage.setItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY, token);
                    localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.REMEMBER_ME_KEY);
                }
            }
            
            static getRefreshToken() {
                return localStorage.getItem(API_CONFIG.TOKEN_CONFIG.REFRESH_TOKEN_KEY);
            }
            
            static setRefreshToken(token) {
                localStorage.setItem(API_CONFIG.TOKEN_CONFIG.REFRESH_TOKEN_KEY, token);
            }
            
            static getUserData() {
                const data = localStorage.getItem(API_CONFIG.TOKEN_CONFIG.USER_DATA_KEY);
                return data ? JSON.parse(data) : null;
            }
            
            static setUserData(data) {
                localStorage.setItem(API_CONFIG.TOKEN_CONFIG.USER_DATA_KEY, JSON.stringify(data));
            }
            
            static getTokenExpiry() {
                return localStorage.getItem(API_CONFIG.TOKEN_CONFIG.TOKEN_EXPIRY_KEY);
            }
            
            static setTokenExpiry(expiry) {
                localStorage.setItem(API_CONFIG.TOKEN_CONFIG.TOKEN_EXPIRY_KEY, expiry);
            }
            
            static setSessionTimestamp() {
                localStorage.setItem(API_CONFIG.TOKEN_CONFIG.SESSION_TIMESTAMP, Date.now().toString());
            }
            
            static getSessionTimestamp() {
                return parseInt(localStorage.getItem(API_CONFIG.TOKEN_CONFIG.SESSION_TIMESTAMP) || '0');
            }
            
            static clearAll() {
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY);
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.REFRESH_TOKEN_KEY);
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.USER_DATA_KEY);
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.TOKEN_EXPIRY_KEY);
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.REMEMBER_ME_KEY);
                localStorage.removeItem(API_CONFIG.TOKEN_CONFIG.SESSION_TIMESTAMP);
                sessionStorage.removeItem(API_CONFIG.TOKEN_CONFIG.ACCESS_TOKEN_KEY);
            }
            
            static isTokenValid() {
                const expiry = this.getTokenExpiry();
                if (!expiry) return false;
                
                const now = Date.now();
                return now < parseInt(expiry);
            }
            
            static isSessionFresh() {
                const timestamp = this.getSessionTimestamp();
                if (!timestamp) return false;
                
                const now = Date.now();
                const sessionAge = now - timestamp;
                // Consider session fresh if less than 30 minutes old
                return sessionAge < 30 * 60 * 1000;
            }
        }

        // API Service
        class ApiService {
            static async request(endpoint, method = 'GET', data = null, requiresAuth = true) {
                const url = `${API_CONFIG.BASE_URL}${endpoint}`;
                const headers = { ...API_CONFIG.HEADERS };
                
                if (requiresAuth) {
                    const token = TokenManager.getAccessToken();
                    if (token) {
                        headers['Authorization'] = `Bearer ${token}`;
                    } else {
                        throw new Error('No authentication token found');
                    }
                }
                
                const config = {
                    method,
                    headers,
                    credentials: 'include'
                };
                
                if (data && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(method.toUpperCase())) {
                    config.body = JSON.stringify(data);
                }
                
                try {
                    const response = await fetch(url, config);
                    
                    // Handle token expiration
                    if (response.status === 401) {
                        const refreshed = await this.refreshToken();
                        if (refreshed) {
                            // Retry with new token
                            return await this.request(endpoint, method, data, requiresAuth);
                        } else {
                            throw new Error('Session expired. Please login again.');
                        }
                    }
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.message || `HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    // Update session timestamp on successful requests
                    if (requiresAuth && response.status >= 200 && response.status < 300) {
                        TokenManager.setSessionTimestamp();
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('API Request Error:', error);
                    throw error;
                }
            }
            
            static async refreshToken() {
                try {
                    const refreshToken = TokenManager.getRefreshToken();
                    if (!refreshToken) {
                        return false;
                    }
                    
                    const response = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.REFRESH_TOKEN}`, {
                        method: 'POST',
                        headers: API_CONFIG.HEADERS,
                        body: JSON.stringify({ refresh_token: refreshToken })
                    });
                    
                    if (!response.ok) {
                        return false;
                    }
                    
                    const result = await response.json();
                    
                    const rememberMe = localStorage.getItem(API_CONFIG.TOKEN_CONFIG.REMEMBER_ME_KEY) === 'true';
                    TokenManager.setAccessToken(result.access_token, rememberMe);
                    
                    if (result.refresh_token) {
                        TokenManager.setRefreshToken(result.refresh_token);
                    }
                    
                    if (result.expires_in) {
                        const expiry = Date.now() + (result.expires_in * 1000);
                        TokenManager.setTokenExpiry(expiry.toString());
                    }
                    
                    return true;
                } catch (error) {
                    return false;
                }
            }
            
            static async validateSession() {
                try {
                    const token = TokenManager.getAccessToken();
                    if (!token) {
                        return false;
                    }
                    
                    const response = await this.request(API_CONFIG.ENDPOINTS.VALIDATE_TOKEN, 'GET');
                    return response.valid === true;
                } catch (error) {
                    return false;
                }
            }
            
            static async logout() {
                try {
                    await this.request(API_CONFIG.ENDPOINTS.CUSTOMER_LOGOUT, 'POST');
                } finally {
                    TokenManager.clearAll();
                }
            }
            
            // Profile methods
            static async getProfile() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_PROFILE);
            }
            
            static async updateProfile(data) {
                return await this.request(API_CONFIG.ENDPOINTS.UPDATE_PROFILE, 'PUT', data);
            }
            
            static async updatePreferences(data) {
                return await this.request(API_CONFIG.ENDPOINTS.UPDATE_PREFERENCES, 'PUT', data);
            }
            
            static async changePassword(data) {
                return await this.request(API_CONFIG.ENDPOINTS.CHANGE_PASSWORD, 'POST', data);
            }
            
            static async deleteAccount(password) {
                return await this.request(API_CONFIG.ENDPOINTS.DELETE_ACCOUNT, 'DELETE', { password });
            }
            
            // Two-Factor methods
            static async generate2FASecret() {
                return await this.request(API_CONFIG.ENDPOINTS.GENERATE_2FA_SECRET, 'POST');
            }
            
            static async enable2FA(data) {
                return await this.request(API_CONFIG.ENDPOINTS.ENABLE_2FA, 'POST', data);
            }
            
            static async disable2FA() {
                return await this.request(API_CONFIG.ENDPOINTS.DISABLE_2FA, 'POST');
            }
            
            static async verify2FASetup(code) {
                return await this.request(API_CONFIG.ENDPOINTS.VERIFY_2FA_SETUP, 'POST', { code });
            }
            
            // Orders methods
            static async getOrders(params = {}) {
                const query = new URLSearchParams(params).toString();
                const endpoint = query ? `${API_CONFIG.ENDPOINTS.GET_ORDERS}?${query}` : API_CONFIG.ENDPOINTS.GET_ORDERS;
                return await this.request(endpoint);
            }
            
            static async getRecentOrders(limit = 5) {
                return await this.request(`${API_CONFIG.ENDPOINTS.GET_RECENT_ORDERS}?limit=${limit}`);
            }
            
            static async getOrderCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_ORDER_COUNT);
            }
            
            static async getOrderDetails(id) {
                return await this.request(API_CONFIG.ENDPOINTS.GET_ORDER_DETAILS.replace(':id', id));
            }
            
            static async cancelOrder(id) {
                return await this.request(API_CONFIG.ENDPOINTS.CANCEL_ORDER.replace(':id', id), 'POST');
            }
            
            static async reorder(id) {
                return await this.request(API_CONFIG.ENDPOINTS.REORDER.replace(':id', id), 'POST');
            }
            
            // Appointments methods
            static async getAppointments(params = {}) {
                const query = new URLSearchParams(params).toString();
                const endpoint = query ? `${API_CONFIG.ENDPOINTS.GET_APPOINTMENTS}?${query}` : API_CONFIG.ENDPOINTS.GET_APPOINTMENTS;
                return await this.request(endpoint);
            }
            
            static async getUpcomingAppointments() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_UPCOMING_APPOINTMENTS);
            }
            
            static async getAppointmentCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_APPOINTMENT_COUNT);
            }
            
            static async cancelAppointment(id) {
                return await this.request(API_CONFIG.ENDPOINTS.CANCEL_APPOINTMENT.replace(':id', id), 'POST');
            }
            
            static async rescheduleAppointment(id, data) {
                return await this.request(API_CONFIG.ENDPOINTS.RESCHEDULE_APPOINTMENT.replace(':id', id), 'PUT', data);
            }
            
            // Wishlist methods
            static async getWishlist() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_WISHLIST);
            }
            
            static async getWishlistCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_WISHLIST_COUNT);
            }
            
            static async removeFromWishlist(id) {
                return await this.request(API_CONFIG.ENDPOINTS.REMOVE_FROM_WISHLIST.replace(':id', id), 'DELETE');
            }
            
            static async moveToCart(id) {
                return await this.request(API_CONFIG.ENDPOINTS.MOVE_TO_CART.replace(':id', id), 'POST');
            }
            
            // Addresses methods
            static async getAddresses() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_ADDRESSES);
            }
            
            static async createAddress(data) {
                return await this.request(API_CONFIG.ENDPOINTS.CREATE_ADDRESS, 'POST', data);
            }
            
            static async updateAddress(id, data) {
                return await this.request(API_CONFIG.ENDPOINTS.UPDATE_ADDRESS.replace(':id', id), 'PUT', data);
            }
            
            static async deleteAddress(id) {
                return await this.request(API_CONFIG.ENDPOINTS.DELETE_ADDRESS.replace(':id', id), 'DELETE');
            }
            
            static async setDefaultAddress(id) {
                return await this.request(API_CONFIG.ENDPOINTS.SET_DEFAULT_ADDRESS.replace(':id', id), 'PUT');
            }
            
            // Payment methods
            static async getPaymentMethods() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_PAYMENT_METHODS);
            }
            
            static async createPaymentMethod(data) {
                return await this.request(API_CONFIG.ENDPOINTS.CREATE_PAYMENT_METHOD, 'POST', data);
            }
            
            static async deletePaymentMethod(id) {
                return await this.request(API_CONFIG.ENDPOINTS.DELETE_PAYMENT_METHOD.replace(':id', id), 'DELETE');
            }
            
            static async setDefaultPayment(id) {
                return await this.request(API_CONFIG.ENDPOINTS.SET_DEFAULT_PAYMENT.replace(':id', id), 'PUT');
            }
            
            // Notification methods
            static async getNotificationSettings() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_NOTIFICATION_SETTINGS);
            }
            
            static async updateNotificationSettings(data) {
                return await this.request(API_CONFIG.ENDPOINTS.UPDATE_NOTIFICATION_SETTINGS, 'PUT', data);
            }
            
            static async getUnreadNotificationCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_UNREAD_COUNT);
            }
            
            // Support ticket methods
            static async getTickets(params = {}) {
                const query = new URLSearchParams(params).toString();
                const endpoint = query ? `${API_CONFIG.ENDPOINTS.GET_TICKETS}?${query}` : API_CONFIG.ENDPOINTS.GET_TICKETS;
                return await this.request(endpoint);
            }
            
            static async getTicketCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_TICKET_COUNT);
            }
            
            // Dashboard methods
            static async getDashboardStats() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_DASHBOARD_STATS);
            }
            
            static async getRecentActivity() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_RECENT_ACTIVITY);
            }
            
            static async getCounts() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_COUNTS);
            }
            
            // Cart methods
            static async getCartCount() {
                return await this.request(API_CONFIG.ENDPOINTS.GET_CART_COUNT);
            }
            
            // Product methods
            static async getProduct(id) {
                return await this.request(API_CONFIG.ENDPOINTS.GET_PRODUCT.replace(':id', id));
            }
        }

        // Dashboard Application
        class DashboardApp {
            constructor() {
                this.currentTab = 'overview';
                this.userData = null;
                this.isAuthenticated = false;
                this.sessionTimer = null;
                this.sessionWarningTimer = null;
                this.init();
            }
            
            async init() {
                // Check authentication first
                await this.checkAuthentication();
                
                if (!this.isAuthenticated) {
                    this.showAuthRequired();
                    return;
                }
                
                // Set up session monitoring
                this.startSessionMonitoring();
                
                // Initialize UI
                this.setupEventListeners();
                this.updateUserUI();
                await this.loadInitialData();
                
                // Check URL for tab parameter
                const urlParams = new URLSearchParams(window.location.search);
                const tabParam = urlParams.get('tab');
                if (tabParam && this.isValidTab(tabParam)) {
                    this.switchTab(tabParam);
                }
            }
            
            isValidTab(tab) {
                const validTabs = ['overview', 'profile', 'orders', 'appointments', 'wishlist', 
                                 'addresses', 'payment', 'security', 'notifications', 'support'];
                return validTabs.includes(tab);
            }
            
            async checkAuthentication() {
                try {
                    // Check if we have a token
                    const token = TokenManager.getAccessToken();
                    if (!token) {
                        console.log('No token found');
                        return false;
                    }
                    
                    // Check if token is valid
                    if (!TokenManager.isTokenValid()) {
                        console.log('Token expired');
                        // Try to refresh token
                        const refreshed = await ApiService.refreshToken();
                        if (!refreshed) {
                            return false;
                        }
                    }
                    
                    // Validate session with server
                    this.isAuthenticated = await ApiService.validateSession();
                    return this.isAuthenticated;
                } catch (error) {
                    console.error('Authentication check failed:', error);
                    return false;
                }
            }
            
            showAuthRequired() {
                document.getElementById('auth-required-overlay').classList.add('active');
                // Hide main content
                document.querySelector('.main-content').style.display = 'none';
                document.querySelector('.main-footer').style.display = 'none';
            }
            
            hideAuthRequired() {
                document.getElementById('auth-required-overlay').classList.remove('active');
                // Show main content
                document.querySelector('.main-content').style.display = 'block';
                document.querySelector('.main-footer').style.display = 'block';
            }
            
            startSessionMonitoring() {
                // Clear existing timers
                if (this.sessionTimer) {
                    clearInterval(this.sessionTimer);
                }
                if (this.sessionWarningTimer) {
                    clearInterval(this.sessionWarningTimer);
                }
                
                // Check session every minute
                this.sessionTimer = setInterval(async () => {
                    const isValid = await this.checkAuthentication();
                    if (!isValid) {
                        this.handleSessionExpired();
                    }
                }, 60000); // 1 minute
                
                // Start session warning countdown (5 minutes before expiry)
                this.startSessionWarning();
            }
            
            startSessionWarning() {
                const expiry = parseInt(TokenManager.getTokenExpiry());
                if (!expiry) return;
                
                const now = Date.now();
                const timeUntilExpiry = expiry - now;
                
                // If less than 5 minutes remaining, show warning
                if (timeUntilExpiry < 5 * 60 * 1000) {
                    this.showSessionWarning(Math.floor(timeUntilExpiry / 1000));
                } else {
                    // Schedule warning for 5 minutes before expiry
                    const warningTime = timeUntilExpiry - (5 * 60 * 1000);
                    setTimeout(() => {
                        this.showSessionWarning(5 * 60); // 5 minutes in seconds
                    }, warningTime);
                }
            }
            
            showSessionWarning(seconds) {
                const warning = document.getElementById('session-warning');
                const countdown = document.getElementById('session-countdown');
                
                warning.classList.add('active');
                
                this.sessionWarningTimer = setInterval(() => {
                    seconds--;
                    
                    if (seconds <= 0) {
                        clearInterval(this.sessionWarningTimer);
                        warning.classList.remove('active');
                        this.handleSessionExpired();
                        return;
                    }
                    
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = seconds % 60;
                    countdown.textContent = `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                }, 1000);
            }
            
            async refreshSession() {
                try {
                    const refreshed = await ApiService.refreshToken();
                    if (refreshed) {
                        this.showAlert('Session refreshed successfully', 'success');
                        document.getElementById('session-warning').classList.remove('active');
                        if (this.sessionWarningTimer) {
                            clearInterval(this.sessionWarningTimer);
                        }
                        this.startSessionWarning();
                        return true;
                    }
                } catch (error) {
                    console.error('Failed to refresh session:', error);
                }
                return false;
            }
            
            handleSessionExpired() {
                this.showAlert('Your session has expired. Please log in again.', 'error');
                setTimeout(() => {
                    TokenManager.clearAll();
                    window.location.href = 'login.html';
                }, 2000);
            }
            
            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const tabId = e.currentTarget.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
                
                // Profile form
                document.getElementById('profile-form')?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveProfile();
                });
                
                // Account type toggle
                document.querySelectorAll('input[name="account-type"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        document.getElementById('business-fields').style.display = 
                            e.target.value === 'business' ? 'block' : 'none';
                    });
                });
                
                // Logout buttons
                document.getElementById('logout-btn')?.addEventListener('click', () => this.logout());
                document.getElementById('mobile-logout-btn')?.addEventListener('click', () => this.logout());
                
                // Mobile menu
                document.getElementById('mobile-menu-btn')?.addEventListener('click', this.toggleMobileMenu);
                document.getElementById('mobile-menu-close')?.addEventListener('click', this.toggleMobileMenu);
                
                // User menu
                document.getElementById('user-menu-btn')?.addEventListener('click', this.toggleUserMenu);
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.user-profile')) {
                        document.getElementById('user-dropdown').classList.remove('active');
                    }
                });
                
                // Global search
                document.getElementById('global-search')?.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch(e.target.value);
                    }
                });
            }
            
            toggleMobileMenu() {
                const mobilePanel = document.getElementById('mobile-menu-panel');
                mobilePanel.classList.toggle('active');
            }
            
            toggleUserMenu() {
                const dropdown = document.getElementById('user-dropdown');
                dropdown.classList.toggle('active');
            }
            
            async updateUserUI() {
                try {
                    // Get user data from token manager or fetch from API
                    this.userData = TokenManager.getUserData();
                    
                    if (!this.userData) {
                        // Fetch fresh user data
                        const response = await ApiService.getProfile();
                        this.userData = response.user;
                        TokenManager.setUserData(this.userData);
                    }
                    
                    // Update welcome message
                    const firstName = this.userData.firstName || this.userData.name?.split(' ')[0] || 'User';
                    document.getElementById('welcome-name').textContent = firstName;
                    
                    // Update profile card
                    document.getElementById('profile-name').textContent = 
                        `${this.userData.firstName || ''} ${this.userData.lastName || ''}`.trim() || 
                        this.userData.name || 
                        'User';
                    
                    document.getElementById('profile-email').textContent = this.userData.email || '';
                    
                    // Update mobile user info
                    document.getElementById('mobile-user-name').textContent = 
                        `${this.userData.firstName || ''} ${this.userData.lastName || ''}`.trim() || 
                        this.userData.name || 
                        'User';
                    document.getElementById('mobile-user-email').textContent = this.userData.email || '';
                    
                    // Update user menu name
                    document.getElementById('user-menu-name').textContent = firstName;
                    
                    // Update avatar with initials
                    const initials = this.getInitials(
                        `${this.userData.firstName || ''} ${this.userData.lastName || ''}`.trim() || 
                        this.userData.name || 
                        'User'
                    );
                    document.getElementById('user-avatar').innerHTML = `<span>${initials}</span>`;
                    
                    // Update account status
                    const statusEl = document.getElementById('account-status');
                    const isVerified = this.userData.emailVerified || this.userData.verified;
                    statusEl.textContent = isVerified ? 'Verified Account' : 'Unverified Account';
                    statusEl.className = `account-status ${isVerified ? 'verified' : 'unverified'}`;
                    
                    // Update subtitle for business accounts
                    if (this.userData.accountType === 'business') {
                        document.getElementById('dashboard-subtitle').textContent = 
                            'Manage your business account, bulk orders, and team settings.';
                    }
                    
                    // Show authenticated content
                    this.hideAuthRequired();
                    
                } catch (error) {
                    console.error('Failed to update user UI:', error);
                    this.showAlert('Failed to load user data', 'error');
                }
            }
            
            getInitials(name) {
                return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            }
            
            switchTab(tabId) {
                if (!this.isValidTab(tabId)) {
                    tabId = 'overview';
                }
                
                // Update URL without reload
                const url = new URL(window.location);
                url.searchParams.set('tab', tabId);
                window.history.pushState({}, '', url);
                
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.tab === tabId) {
                        item.classList.add('active');
                    }
                });
                
                // Show active tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                        this.loadTabContent(tabId);
                    }
                });
                
                this.currentTab = tabId;
                
                // Close mobile menu if open
                document.getElementById('mobile-menu-panel').classList.remove('active');
                
                // Close user dropdown if open
                document.getElementById('user-dropdown').classList.remove('active');
            }
            
            async loadInitialData() {
                try {
                    await Promise.all([
                        this.loadOverviewData(),
                        this.updateCounts()
                    ]);
                } catch (error) {
                    console.error('Error loading initial data:', error);
                    this.showAlert('Failed to load dashboard data', 'error');
                }
            }
            
            async loadTabContent(tabId) {
                try {
                    switch(tabId) {
                        case 'overview':
                            await this.loadOverviewData();
                            break;
                        case 'profile':
                            await this.loadProfileData();
                            break;
                        case 'orders':
                            await this.loadOrders();
                            break;
                        case 'appointments':
                            await this.loadAppointments();
                            break;
                        case 'wishlist':
                            await this.loadWishlist();
                            break;
                        case 'addresses':
                            await this.loadAddresses();
                            break;
                        case 'payment':
                            await this.loadPaymentMethods();
                            break;
                        case 'security':
                            await this.loadSecuritySettings();
                            break;
                        case 'notifications':
                            await this.loadNotificationSettings();
                            break;
                        case 'support':
                            await this.loadSupportTickets();
                            break;
                    }
                } catch (error) {
                    console.error(`Error loading ${tabId}:`, error);
                    this.showAlert(`Failed to load ${tabId} data`, 'error');
                }
            }
            
            async loadOverviewData() {
                try {
                    // Show loading state
                    document.getElementById('overview-loading').style.display = 'block';
                    
                    const [stats, recentOrders, appointments, activity] = await Promise.all([
                        ApiService.getDashboardStats(),
                        ApiService.getRecentOrders(5),
                        ApiService.getUpcomingAppointments(),
                        ApiService.getRecentActivity()
                    ]);
                    
                    // Update stats
                    if (stats.success) {
                        document.getElementById('total-orders').textContent = stats.stats?.totalOrders || 0;
                        document.getElementById('total-services').textContent = stats.stats?.totalServices || 0;
                        document.getElementById('total-spent').textContent = `$${(stats.stats?.totalSpent || 0).toFixed(2)}`;
                        document.getElementById('member-since').textContent = stats.stats?.memberMonths || 0;
                        
                        // Hide loading, show content
                        document.getElementById('overview-loading').style.display = 'none';
                        document.getElementById('stats-section').style.display = 'block';
                    }
                    
                    // Update recent orders
                    if (recentOrders.success) {
                        this.renderRecentOrders(recentOrders.orders || []);
                        document.getElementById('recent-orders-section').style.display = 'block';
                    } else {
                        document.getElementById('no-recent-orders').style.display = 'block';
                    }
                    
                    // Update appointments
                    if (appointments.success && appointments.appointments?.length > 0) {
                        this.renderAppointments(appointments.appointments || []);
                        document.getElementById('appointments-section').style.display = 'block';
                    } else {
                        document.getElementById('no-appointments').style.display = 'block';
                    }
                    
                    // Update activity
                    if (activity.success && activity.activities?.length > 0) {
                        this.renderActivity(activity.activities || []);
                        document.getElementById('activity-section').style.display = 'block';
                    } else {
                        document.getElementById('no-activity').style.display = 'block';
                    }
                } catch (error) {
                    document.getElementById('overview-loading').style.display = 'none';
                    throw error;
                }
            }
            
            async loadProfileData() {
                try {
                    document.getElementById('profile-loading').style.display = 'block';
                    document.getElementById('profile-form').style.display = 'none';
                    
                    const response = await ApiService.getProfile();
                    const profile = response.user;
                    
                    if (!profile) {
                        throw new Error('No profile data received');
                    }
                    
                    // Populate form
                    document.getElementById('first-name').value = profile.firstName || '';
                    document.getElementById('last-name').value = profile.lastName || '';
                    document.getElementById('profile-email').value = profile.email || '';
                    document.getElementById('profile-phone').value = profile.phone || '';
                    document.getElementById('date-of-birth').value = profile.dateOfBirth || '';
                    
                    // Account type
                    const accountType = profile.accountType || 'personal';
                    document.querySelector(`input[name="account-type"][value="${accountType}"]`).checked = true;
                    document.getElementById('business-fields').style.display = 
                        accountType === 'business' ? 'block' : 'none';
                    
                    // Business fields
                    document.getElementById('company-name').value = profile.companyName || '';
                    document.getElementById('tax-id').value = profile.taxId || '';
                    
                    // Preferences
                    document.getElementById('email-marketing').checked = profile.marketingConsent || false;
                    document.getElementById('sms-notifications').checked = profile.preferences?.smsNotifications || false;
                    
                    document.getElementById('profile-loading').style.display = 'none';
                    document.getElementById('profile-form').style.display = 'block';
                } catch (error) {
                    document.getElementById('profile-loading').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load profile data</span>
                        </div>
                    `;
                    throw error;
                }
            }
            
            async saveProfile() {
                const saveBtn = document.getElementById('save-profile');
                const saveText = document.getElementById('save-text');
                const saveSpinner = document.getElementById('save-spinner');
                
                // Show loading state
                saveBtn.disabled = true;
                saveText.style.display = 'none';
                saveSpinner.style.display = 'inline-block';
                
                try {
                    const formData = {
                        firstName: document.getElementById('first-name').value.trim(),
                        lastName: document.getElementById('last-name').value.trim(),
                        phone: document.getElementById('profile-phone').value.trim(),
                        dateOfBirth: document.getElementById('date-of-birth').value,
                        accountType: document.querySelector('input[name="account-type"]:checked').value,
                        companyName: document.getElementById('company-name').value.trim(),
                        taxId: document.getElementById('tax-id').value.trim(),
                        marketingConsent: document.getElementById('email-marketing').checked,
                        preferences: {
                            smsNotifications: document.getElementById('sms-notifications').checked
                        }
                    };
                    
                    const response = await ApiService.updateProfile(formData);
                    this.userData = { ...this.userData, ...response.user };
                    TokenManager.setUserData(this.userData);
                    this.updateUserUI();
                    this.showAlert('Profile updated successfully!', 'success');
                } catch (error) {
                    this.showAlert(error.message || 'Failed to update profile', 'error');
                } finally {
                    saveBtn.disabled = false;
                    saveText.style.display = 'inline';
                    saveSpinner.style.display = 'none';
                }
            }
            
            async loadOrders() {
                try {
                    const response = await ApiService.getOrders();
                    this.renderOrders(response.orders || []);
                } catch (error) {
                    document.getElementById('orders-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load orders</span>
                        </div>
                    `;
                }
            }
            
            async loadAppointments() {
                try {
                    const response = await ApiService.getAppointments();
                    this.renderAppointmentsTab(response.appointments || []);
                } catch (error) {
                    document.getElementById('appointments-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load appointments</span>
                        </div>
                    `;
                }
            }
            
            async loadWishlist() {
                try {
                    const response = await ApiService.getWishlist();
                    this.renderWishlist(response.wishlist || []);
                } catch (error) {
                    document.getElementById('wishlist-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load wishlist</span>
                        </div>
                    `;
                }
            }
            
            async loadAddresses() {
                try {
                    const response = await ApiService.getAddresses();
                    this.renderAddresses(response.addresses || []);
                } catch (error) {
                    document.getElementById('addresses-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load addresses</span>
                        </div>
                    `;
                }
            }
            
            async loadPaymentMethods() {
                try {
                    const response = await ApiService.getPaymentMethods();
                    this.renderPaymentMethods(response.paymentMethods || []);
                } catch (error) {
                    document.getElementById('payment-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load payment methods</span>
                        </div>
                    `;
                }
            }
            
            async loadSecuritySettings() {
                try {
                    const response = await ApiService.getProfile();
                    this.renderSecuritySettings(response.user || {});
                } catch (error) {
                    document.getElementById('security-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load security settings</span>
                        </div>
                    `;
                }
            }
            
            async loadNotificationSettings() {
                try {
                    const response = await ApiService.getNotificationSettings();
                    this.renderNotificationSettings(response.settings || {});
                } catch (error) {
                    document.getElementById('notifications-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load notification settings</span>
                        </div>
                    `;
                }
            }
            
            async loadSupportTickets() {
                try {
                    const response = await ApiService.getTickets();
                    this.renderSupportTickets(response.tickets || []);
                } catch (error) {
                    document.getElementById('support-content').innerHTML = `
                        <div class="alert-message alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>Failed to load support tickets</span>
                        </div>
                    `;
                }
            }
            
            async updateCounts() {
                try {
                    const response = await ApiService.getCounts();
                    const counts = response.counts || {};
                    
                    // Update sidebar counts
                    document.getElementById('orders-count').textContent = counts.orders || 0;
                    document.getElementById('appointments-count').textContent = counts.appointments || 0;
                    document.getElementById('wishlist-count').textContent = counts.wishlist || 0;
                    
                    // Update header counts
                    document.getElementById('header-wishlist-count').textContent = counts.wishlist || 0;
                    document.getElementById('header-cart-count').textContent = counts.cart || 0;
                    document.getElementById('mobile-wishlist-count').textContent = counts.wishlist || 0;
                    document.getElementById('mobile-cart-count').textContent = counts.cart || 0;
                    
                    // Update notification badge if any
                    if (counts.unreadNotifications > 0) {
                        // Add notification badge logic here
                    }
                } catch (error) {
                    console.error('Error updating counts:', error);
                }
            }
            
            // Rendering Methods
            renderRecentOrders(orders) {
                const tbody = document.getElementById('recent-orders-body');
                const noOrders = document.getElementById('no-recent-orders');
                
                if (!tbody) return;
                
                tbody.innerHTML = '';
                
                if (orders.length === 0) {
                    noOrders.style.display = 'block';
                    return;
                }
                
                noOrders.style.display = 'none';
                
                orders.forEach(order => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${order.orderNumber || order.id || 'N/A'}</td>
                        <td>${this.formatDate(order.createdAt)}</td>
                        <td>${order.items?.slice(0, 2).map(item => item.name).join(', ') || 'No items'}</td>
                        <td>$${(order.total || 0).toFixed(2)}</td>
                        <td><span class="order-status status-${order.status || 'pending'}">${this.formatStatus(order.status)}</span></td>
                        <td>
                            <div class="order-actions">
                                <button class="order-action-btn view" onclick="dashboard.viewOrder('${order.id}')">View</button>
                                ${order.status === 'shipped' ? `<button class="order-action-btn track" onclick="dashboard.trackOrder('${order.id}')">Track</button>` : ''}
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            renderOrders(orders) {
                const container = document.getElementById('orders-content');
                
                if (!orders || orders.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-bag"></i>
                            <h3>No Orders Yet</h3>
                            <p>You haven't placed any orders yet. Start shopping to see your orders here.</p>
                            <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                                Start Shopping
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div class="table-responsive">
                        <table class="orders-table">
                            <thead>
                                <tr>
                                    <th>Order ID</th>
                                    <th>Date</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                orders.forEach(order => {
                    html += `
                        <tr>
                            <td>${order.orderNumber || order.id}</td>
                            <td>${this.formatDate(order.createdAt)}</td>
                            <td>${order.items?.slice(0, 2).map(item => item.name).join(', ') || 'No items'}</td>
                            <td>$${(order.total || 0).toFixed(2)}</td>
                            <td><span class="order-status status-${order.status || 'pending'}">${this.formatStatus(order.status)}</span></td>
                            <td>
                                <div class="order-actions">
                                    <button class="order-action-btn view" onclick="dashboard.viewOrder('${order.id}')">View</button>
                                    ${order.status === 'shipped' ? `<button class="order-action-btn track" onclick="dashboard.trackOrder('${order.id}')">Track</button>` : ''}
                                    ${order.status === 'delivered' ? `<button class="order-action-btn view" onclick="dashboard.reorder('${order.id}')">Reorder</button>` : ''}
                                </div>
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                    </div>
                `;
                
                container.innerHTML = html;
            }
            
            renderAppointments(appointments) {
                const container = document.getElementById('upcoming-appointments');
                const noAppointments = document.getElementById('no-appointments');
                
                if (!container) return;
                
                container.innerHTML = '';
                
                if (appointments.length === 0) {
                    noAppointments.style.display = 'block';
                    return;
                }
                
                noAppointments.style.display = 'none';
                
                appointments.forEach(appointment => {
                    const card = document.createElement('div');
                    card.className = 'appointment-card';
                    card.innerHTML = `
                        <div class="appointment-header">
                            <div>
                                <h3 class="appointment-title">${appointment.service || 'Service'}</h3>
                                <p class="appointment-date">${this.formatDateTime(appointment.scheduledDate)}</p>
                            </div>
                            <span class="appointment-status status-${appointment.status || 'scheduled'}">${this.formatStatus(appointment.status)}</span>
                        </div>
                        
                        <div class="appointment-details">
                            <div class="appointment-detail">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${appointment.location || 'Location not specified'}</span>
                            </div>
                            <div class="appointment-detail">
                                <i class="fas fa-tools"></i>
                                <span>${appointment.device || 'Device not specified'}</span>
                            </div>
                            ${appointment.technician ? `
                            <div class="appointment-detail">
                                <i class="fas fa-user"></i>
                                <span>Assigned to: ${appointment.technician}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="appointment-actions">
                            <button class="appointment-action-btn primary" onclick="dashboard.rescheduleAppointment('${appointment.id}')">Reschedule</button>
                            <button class="appointment-action-btn secondary" onclick="dashboard.cancelAppointment('${appointment.id}')">Cancel</button>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
            
            renderAppointmentsTab(appointments) {
                const container = document.getElementById('appointments-content');
                
                if (!appointments || appointments.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>No Appointments</h3>
                            <p>You haven't booked any service appointments yet.</p>
                            <button class="quick-action-btn primary" onclick="window.location.href='booking-form.html'">
                                Book a Service
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="appointments-grid">';
                
                appointments.forEach(appointment => {
                    html += `
                        <div class="appointment-card">
                            <div class="appointment-header">
                                <div>
                                    <h3 class="appointment-title">${appointment.service || 'Service'}</h3>
                                    <p class="appointment-date">${this.formatDateTime(appointment.scheduledDate)}</p>
                                </div>
                                <span class="appointment-status status-${appointment.status || 'scheduled'}">${this.formatStatus(appointment.status)}</span>
                            </div>
                            
                            <div class="appointment-details">
                                <div class="appointment-detail">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>${appointment.location || 'Location not specified'}</span>
                                </div>
                                <div class="appointment-detail">
                                    <i class="fas fa-tools"></i>
                                    <span>${appointment.device || 'Device not specified'}</span>
                                </div>
                                ${appointment.technician ? `
                                <div class="appointment-detail">
                                    <i class="fas fa-user"></i>
                                    <span>Assigned to: ${appointment.technician}</span>
                                </div>
                                ` : ''}
                                ${appointment.notes ? `
                                <div class="appointment-detail">
                                    <i class="fas fa-sticky-note"></i>
                                    <span>${appointment.notes.substring(0, 50)}${appointment.notes.length > 50 ? '...' : ''}</span>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="appointment-actions">
                                ${appointment.status === 'scheduled' ? `
                                <button class="appointment-action-btn primary" onclick="dashboard.rescheduleAppointment('${appointment.id}')">Reschedule</button>
                                <button class="appointment-action-btn secondary" onclick="dashboard.cancelAppointment('${appointment.id}')">Cancel</button>
                                ` : ''}
                                <button class="appointment-action-btn view" onclick="dashboard.viewAppointment('${appointment.id}')">Details</button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            renderActivity(activities) {
                const container = document.getElementById('recent-activity');
                const noActivity = document.getElementById('no-activity');
                
                if (!container) return;
                
                container.innerHTML = '';
                
                if (activities.length === 0) {
                    noActivity.style.display = 'block';
                    return;
                }
                
                noActivity.style.display = 'none';
                
                activities.forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div class="activity-icon">
                            <i class="fas fa-${activity.icon || 'bell'}"></i>
                        </div>
                        <div class="activity-content">
                            <p class="activity-text">${activity.description || 'Activity'}</p>
                            <p class="activity-time">${this.formatTimeAgo(activity.createdAt)}</p>
                        </div>
                    `;
                    container.appendChild(item);
                });
            }
            
            renderWishlist(wishlist) {
                const container = document.getElementById('wishlist-content');
                
                if (!wishlist || wishlist.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-heart"></i>
                            <h3>Your Wishlist is Empty</h3>
                            <p>Add products you like to your wishlist to save them for later.</p>
                            <button class="quick-action-btn primary" onclick="window.location.href='products.html'">
                                Browse Products
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="wishlist-grid">';
                
                wishlist.forEach(item => {
                    const product = item.product || item;
                    html += `
                        <div class="wishlist-item" data-id="${product.id}">
                            <div class="wishlist-image">
                                ${product.image ? 
                                    `<img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover;">` :
                                    `<i class="fas fa-box"></i>`
                                }
                            </div>
                            <div class="wishlist-details">
                                <h3 class="wishlist-title">${product.name || 'Product'}</h3>
                                <div class="wishlist-price">$${(product.price || 0).toFixed(2)}</div>
                                <div class="wishlist-actions">
                                    <button class="wishlist-action-btn add-to-cart" onclick="dashboard.addToCartFromWishlist('${product.id}')">Add to Cart</button>
                                    <button class="wishlist-action-btn remove" onclick="dashboard.removeFromWishlist('${item.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            renderAddresses(addresses) {
                const container = document.getElementById('addresses-content');
                
                if (!addresses || addresses.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3>No Saved Addresses</h3>
                            <p>Add addresses for faster checkout.</p>
                            <button class="quick-action-btn primary" onclick="dashboard.showAddressModal()">
                                Add Address
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="address-grid">';
                
                addresses.forEach(address => {
                    html += `
                        <div class="address-card ${address.isDefault ? 'default' : ''}">
                            ${address.isDefault ? '<span class="address-type">Default</span>' : ''}
                            <h3>${address.name || 'Address'}</h3>
                            <p>${address.street || ''}</p>
                            ${address.apartment ? `<p>${address.apartment}</p>` : ''}
                            <p>${address.city || ''}, ${address.state || ''} ${address.zipCode || ''}</p>
                            <p>${address.country || ''}</p>
                            <p><strong>Phone:</strong> ${address.phone || ''}</p>
                            
                            <div class="address-actions">
                                ${!address.isDefault ? `
                                <button class="order-action-btn" onclick="dashboard.setDefaultAddress('${address.id}')">Set as Default</button>
                                ` : ''}
                                <button class="order-action-btn view" onclick="dashboard.editAddress('${address.id}')">Edit</button>
                                <button class="order-action-btn secondary" onclick="dashboard.deleteAddress('${address.id}')">Delete</button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            renderPaymentMethods(payments) {
                const container = document.getElementById('payment-content');
                
                if (!payments || payments.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-credit-card"></i>
                            <h3>No Payment Methods</h3>
                            <p>Add payment methods for faster checkout.</p>
                            <button class="quick-action-btn primary" onclick="dashboard.showPaymentModal()">
                                Add Payment Method
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="payment-methods">';
                
                payments.forEach(payment => {
                    const cardIcon = payment.cardType === 'visa' ? 'cc-visa' : 
                                    payment.cardType === 'mastercard' ? 'cc-mastercard' : 
                                    payment.cardType === 'amex' ? 'cc-amex' : 'credit-card';
                    
                    html += `
                        <div class="payment-method">
                            <div class="payment-info">
                                <div class="payment-icon">
                                    <i class="fab fa-${cardIcon}"></i>
                                </div>
                                <div>
                                    <h4>${(payment.cardType?.charAt(0).toUpperCase() + payment.cardType?.slice(1)) || 'Card'}  ${payment.last4 || '0000'}</h4>
                                    <p>Expires ${payment.expiryMonth || 'MM'}/${payment.expiryYear || 'YY'}</p>
                                    ${payment.isDefault ? '<span style="color: var(--primary-blue); font-size: 0.8rem;">Default</span>' : ''}
                                </div>
                            </div>
                            <div>
                                ${!payment.isDefault ? `
                                <button class="order-action-btn" onclick="dashboard.setDefaultPayment('${payment.id}')">Set as Default</button>
                                ` : ''}
                                <button class="order-action-btn secondary" onclick="dashboard.deletePayment('${payment.id}')">Remove</button>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            renderSecuritySettings(userData) {
                const container = document.getElementById('security-content');
                
                container.innerHTML = `
                    <div class="security-item">
                        <div class="security-info">
                            <h4>Two-Factor Authentication</h4>
                            <p>Add an extra layer of security to your account</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="2fa-toggle" ${userData.twoFactorEnabled ? 'checked' : ''}>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="security-item">
                        <div class="security-info">
                            <h4>Change Password</h4>
                            <p>Update your password regularly for better security</p>
                        </div>
                        <button class="quick-action-btn secondary" onclick="dashboard.showChangePasswordModal()">Change Password</button>
                    </div>
                    
                    <div class="security-item">
                        <div class="security-info">
                            <h4>Active Sessions</h4>
                            <p>Manage your logged-in devices and sessions</p>
                        </div>
                        <button class="quick-action-btn secondary" onclick="dashboard.viewActiveSessions()">View Sessions</button>
                    </div>
                    
                    <div class="security-item">
                        <div class="security-info">
                            <h4>Account Activity</h4>
                            <p>Review recent account activity and security events</p>
                        </div>
                        <button class="quick-action-btn secondary" onclick="dashboard.viewAccountActivity()">View Activity</button>
                    </div>
                    
                    <div class="security-item">
                        <div class="security-info">
                            <h4>Delete Account</h4>
                            <p>Permanently delete your account and all data</p>
                        </div>
                        <button class="quick-action-btn secondary" style="color: var(--error); border-color: var(--error);" onclick="dashboard.showDeleteAccountModal()">Delete Account</button>
                    </div>
                `;
                
                // Add event listener for 2FA toggle
                document.getElementById('2fa-toggle').addEventListener('change', (e) => {
                    if (e.target.checked) {
                        this.showTwoFactorModal();
                    } else {
                        this.disableTwoFactor();
                    }
                });
            }
            
            renderNotificationSettings(settings) {
                const container = document.getElementById('notifications-content');
                
                const defaultSettings = {
                    email: {
                        orderUpdates: true,
                        promotions: true,
                        accountAlerts: true,
                        appointmentReminders: true
                    },
                    push: {
                        orderUpdates: true,
                        promotions: false,
                        accountAlerts: true
                    },
                    sms: {
                        orderUpdates: false,
                        appointmentReminders: true,
                        securityAlerts: true
                    }
                };
                
                const notificationSettings = settings || defaultSettings;
                
                container.innerHTML = `
                    <div class="notification-category">
                        <h4>Email Notifications</h4>
                        ${this.renderNotificationCategory('email', notificationSettings.email || {})}
                    </div>
                    
                    <div class="notification-category">
                        <h4>Push Notifications</h4>
                        ${this.renderNotificationCategory('push', notificationSettings.push || {})}
                    </div>
                    
                    <div class="notification-category">
                        <h4>SMS Notifications</h4>
                        ${this.renderNotificationCategory('sms', notificationSettings.sms || {})}
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-save" onclick="dashboard.saveNotificationSettings()">Save Settings</button>
                    </div>
                `;
            }
            
            renderNotificationCategory(type, category) {
                let html = '';
                for (const [key, value] of Object.entries(category)) {
                    const label = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    html += `
                        <div class="notification-item">
                            <span>${label}</span>
                            <label class="toggle-switch">
                                <input type="checkbox" data-type="${type}" data-key="${key}" ${value ? 'checked' : ''}>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    `;
                }
                return html;
            }
            
            renderSupportTickets(tickets) {
                const container = document.getElementById('support-content');
                
                if (!tickets || tickets.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-headset"></i>
                            <h3>No Support Tickets</h3>
                            <p>You haven't created any support tickets yet.</p>
                            <button class="quick-action-btn primary" onclick="window.location.href='support.html'">
                                Contact Support
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = '<div class="tickets-list" style="display: flex; flex-direction: column; gap: 15px;">';
                
                tickets.forEach(ticket => {
                    const icon = ticket.category === 'technical' ? 'tools' : 
                                ticket.category === 'billing' ? 'credit-card' : 
                                ticket.category === 'shipping' ? 'shipping-fast' : 'question-circle';
                    
                    html += `
                        <div class="ticket-item" style="display: flex; align-items: center; gap: 15px; padding: 20px; background: #f9f9f9; border-radius: 10px;">
                            <div class="ticket-icon" style="width: 40px; height: 40px; border-radius: 50%; background: white; display: flex; align-items: center; justify-content: center; color: var(--primary-blue);">
                                <i class="fas fa-${icon}"></i>
                            </div>
                            <div class="ticket-content" style="flex: 1;">
                                <h3 class="ticket-title" style="margin: 0 0 5px 0; color: var(--primary-text);">${ticket.subject || 'No subject'}</h3>
                                <div class="ticket-meta" style="display: flex; gap: 15px; font-size: 0.85rem; color: var(--secondary-text);">
                                    <span>Created: ${this.formatDate(ticket.createdAt)}</span>
                                    <span>Ticket ID: ${ticket.ticketNumber || 'N/A'}</span>
                                    ${ticket.updatedAt ? `<span>Updated: ${this.formatDate(ticket.updatedAt)}</span>` : ''}
                                </div>
                            </div>
                            <span class="ticket-status status-${ticket.status || 'open'}" style="padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; background: ${this.getStatusColor(ticket.status)}; color: white;">${this.formatStatus(ticket.status)}</span>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            }
            
            // Action Methods
            async logout() {
                if (confirm('Are you sure you want to logout?')) {
                    try {
                        await ApiService.logout();
                        TokenManager.clearAll();
                        window.location.href = 'login.html';
                    } catch (error) {
                        console.error('Logout failed:', error);
                        // Still clear local data and redirect
                        TokenManager.clearAll();
                        window.location.href = 'login.html';
                    }
                }
            }
            
            viewOrder(orderId) {
                window.location.href = `order-details.html?id=${orderId}`;
            }
            
            trackOrder(orderId) {
                window.location.href = `order-tracking.html?id=${orderId}`;
            }
            
            async reorder(orderId) {
                try {
                    await ApiService.reorder(orderId);
                    this.showAlert('Items added to cart from order', 'success');
                    this.updateCounts();
                } catch (error) {
                    this.showAlert('Failed to reorder', 'error');
                }
            }
            
            rescheduleAppointment(appointmentId) {
                window.location.href = `booking-form.html?reschedule=${appointmentId}`;
            }
            
            async cancelAppointment(appointmentId) {
                if (!confirm('Are you sure you want to cancel this appointment?')) return;
                
                try {
                    await ApiService.cancelAppointment(appointmentId);
                    this.showAlert('Appointment cancelled successfully', 'success');
                    this.loadTabContent(this.currentTab);
                    this.updateCounts();
                } catch (error) {
                    this.showAlert('Failed to cancel appointment', 'error');
                }
            }
            
            viewAppointment(appointmentId) {
                window.location.href = `appointment-details.html?id=${appointmentId}`;
            }
            
            async addToCartFromWishlist(productId) {
                try {
                    // First get product details
                    const product = await ApiService.getProduct(productId);
                    // Then add to cart (you would implement this endpoint)
                    this.showAlert('Product added to cart!', 'success');
                    this.updateCounts();
                } catch (error) {
                    this.showAlert('Failed to add to cart', 'error');
                }
            }
            
            async removeFromWishlist(wishlistItemId) {
                if (!confirm('Remove this item from your wishlist?')) return;
                
                try {
                    await ApiService.removeFromWishlist(wishlistItemId);
                    this.showAlert('Item removed from wishlist', 'success');
                    this.loadTabContent('wishlist');
                    this.updateCounts();
                } catch (error) {
                    this.showAlert('Failed to remove from wishlist', 'error');
                }
            }
            
            showAddressModal() {
                document.getElementById('address-modal').classList.add('active');
            }
            
            async saveAddress() {
                const form = document.getElementById('address-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const addressData = {
                    name: document.getElementById('address-name').value,
                    fullName: document.getElementById('full-name').value,
                    street: document.getElementById('street-address').value,
                    apartment: document.getElementById('apartment').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    zipCode: document.getElementById('zip-code').value,
                    country: document.getElementById('country').value,
                    phone: document.getElementById('phone-number').value,
                    isDefault: document.getElementById('set-default-address').checked
                };
                
                try {
                    await ApiService.createAddress(addressData);
                    this.showAlert('Address saved successfully', 'success');
                    this.closeModal('address-modal');
                    this.loadTabContent('addresses');
                } catch (error) {
                    this.showAlert('Failed to save address', 'error');
                }
            }
            
            async setDefaultAddress(addressId) {
                try {
                    await ApiService.setDefaultAddress(addressId);
                    this.showAlert('Default address updated', 'success');
                    this.loadTabContent('addresses');
                } catch (error) {
                    this.showAlert('Failed to update address', 'error');
                }
            }
            
            async deleteAddress(addressId) {
                if (!confirm('Delete this address?')) return;
                
                try {
                    await ApiService.deleteAddress(addressId);
                    this.showAlert('Address deleted', 'success');
                    this.loadTabContent('addresses');
                } catch (error) {
                    this.showAlert('Failed to delete address', 'error');
                }
            }
            
            showPaymentModal() {
                document.getElementById('payment-modal').classList.add('active');
            }
            
            async savePaymentMethod() {
                const form = document.getElementById('payment-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const cardData = {
                    cardType: document.querySelector('input[name="card-type"]:checked').value,
                    nameOnCard: document.getElementById('card-name').value,
                    cardNumber: document.getElementById('card-number').value,
                    expiryDate: document.getElementById('expiry-date').value,
                    cvv: document.getElementById('cvv').value,
                    isDefault: document.getElementById('set-default-payment').checked
                };
                
                try {
                    await ApiService.createPaymentMethod(cardData);
                    this.showAlert('Payment method saved successfully', 'success');
                    this.closeModal('payment-modal');
                    this.loadTabContent('payment');
                } catch (error) {
                    this.showAlert('Failed to save payment method', 'error');
                }
            }
            
            async setDefaultPayment(paymentId) {
                try {
                    await ApiService.setDefaultPayment(paymentId);
                    this.showAlert('Default payment method updated', 'success');
                    this.loadTabContent('payment');
                } catch (error) {
                    this.showAlert('Failed to update payment method', 'error');
                }
            }
            
            async deletePayment(paymentId) {
                if (!confirm('Remove this payment method?')) return;
                
                try {
                    await ApiService.deletePaymentMethod(paymentId);
                    this.showAlert('Payment method removed', 'success');
                    this.loadTabContent('payment');
                } catch (error) {
                    this.showAlert('Failed to remove payment method', 'error');
                }
            }
            
            showChangePasswordModal() {
                document.getElementById('change-password-modal').classList.add('active');
            }
            
            async changePassword() {
                const form = document.getElementById('change-password-form');
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }
                
                const passwordData = {
                    currentPassword: document.getElementById('current-password').value,
                    newPassword: document.getElementById('new-password').value,
                    confirmPassword: document.getElementById('confirm-password').value
                };
                
                if (passwordData.newPassword !== passwordData.confirmPassword) {
                    this.showAlert('New passwords do not match', 'error');
                    return;
                }
                
                try {
                    await ApiService.changePassword(passwordData);
                    this.showAlert('Password changed successfully', 'success');
                    this.closeModal('change-password-modal');
                } catch (error) {
                    this.showAlert('Failed to change password', 'error');
                }
            }
            
            showTwoFactorModal() {
                document.getElementById('two-factor-modal').classList.add('active');
                this.loadTwoFactorSetup();
            }
            
            async loadTwoFactorSetup() {
                try {
                    const response = await ApiService.generate2FASecret();
                    document.getElementById('two-factor-secret').textContent = response.secret;
                    // In a real implementation, you would generate a QR code here
                    document.getElementById('two-factor-setup').style.display = 'block';
                    document.getElementById('two-factor-save').textContent = 'Enable 2FA';
                } catch (error) {
                    this.showAlert('Failed to setup two-factor authentication', 'error');
                }
            }
            
            async saveTwoFactor() {
                const code = document.getElementById('two-factor-code').value;
                if (!code || code.length !== 6) {
                    this.showAlert('Please enter a valid 6-digit code', 'error');
                    return;
                }
                
                try {
                    await ApiService.verify2FASetup(code);
                    this.showAlert('Two-factor authentication enabled successfully', 'success');
                    this.closeModal('two-factor-modal');
                    this.loadTabContent('security');
                } catch (error) {
                    this.showAlert('Failed to enable two-factor authentication', 'error');
                }
            }
            
            async disableTwoFactor() {
                if (!confirm('Disable two-factor authentication? This reduces your account security.')) {
                    // Reset toggle
                    document.getElementById('2fa-toggle').checked = true;
                    return;
                }
                
                try {
                    await ApiService.disable2FA();
                    this.showAlert('Two-factor authentication disabled', 'success');
                    this.loadTabContent('security');
                } catch (error) {
                    this.showAlert('Failed to disable two-factor authentication', 'error');
                    // Reset toggle
                    document.getElementById('2fa-toggle').checked = true;
                }
            }
            
            async saveNotificationSettings() {
                const settings = {
                    email: {},
                    push: {},
                    sms: {}
                };
                
                // Collect all toggle values
                document.querySelectorAll('#notifications-content input[type="checkbox"]').forEach(input => {
                    const type = input.dataset.type;
                    const key = input.dataset.key;
                    if (type && key) {
                        settings[type][key] = input.checked;
                    }
                });
                
                try {
                    await ApiService.updateNotificationSettings(settings);
                    this.showAlert('Notification settings updated', 'success');
                } catch (error) {
                    this.showAlert('Failed to update notification settings', 'error');
                }
            }
            
            showDeleteAccountModal() {
                document.getElementById('delete-account-modal').classList.add('active');
            }
            
            async deleteAccount() {
                const password = document.getElementById('delete-password').value;
                if (!password) {
                    this.showAlert('Please enter your password', 'error');
                    return;
                }
                
                if (!confirm('Are you absolutely sure you want to delete your account? This action cannot be undone.')) {
                    return;
                }
                
                try {
                    await ApiService.deleteAccount(password);
                    this.showAlert('Account deleted successfully', 'success');
                    TokenManager.clearAll();
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 2000);
                } catch (error) {
                    this.showAlert('Failed to delete account', 'error');
                }
            }
            
            viewActiveSessions() {
                this.showAlert('Active sessions feature coming soon', 'info');
            }
            
            viewAccountActivity() {
                this.showAlert('Account activity feature coming soon', 'info');
            }
            
            performSearch(query) {
                if (!query.trim()) return;
                window.location.href = `products.html?search=${encodeURIComponent(query)}`;
            }
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
            
            showAlert(message, type = 'info') {
                const alertArea = document.getElementById('alert-area');
                const alert = document.createElement('div');
                alert.className = `alert-message alert-${type}`;
                alert.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                    <button style="margin-left: auto; background: none; border: none; cursor: pointer; color: inherit;" onclick="this.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                alertArea.appendChild(alert);
                
                // Auto-remove after 5 seconds
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 5000);
            }
            
            // Utility Methods
            formatDate(dateString) {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
            }
            
            formatDateTime(dateTimeString) {
                if (!dateTimeString) return 'N/A';
                const date = new Date(dateTimeString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            formatTimeAgo(dateString) {
                if (!dateString) return 'Unknown time';
                const date = new Date(dateString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMs / 3600000);
                const diffDays = Math.floor(diffMs / 86400000);
                
                if (diffMins < 1) return 'Just now';
                if (diffMins < 60) return `${diffMins} minute${diffMins !== 1 ? 's' : ''} ago`;
                if (diffHours < 24) return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
                if (diffDays < 7) return `${diffDays} day${diffDays !== 1 ? 's' : ''} ago`;
                return this.formatDate(dateString);
            }
            
            formatStatus(status) {
                if (!status) return 'Pending';
                return status.charAt(0).toUpperCase() + status.slice(1);
            }
            
            getStatusColor(status) {
                switch(status) {
                    case 'processing': return '#ff9800';
                    case 'shipped': return '#2196f3';
                    case 'delivered': return '#4caf50';
                    case 'cancelled': return '#f44336';
                    case 'scheduled': return '#2196f3';
                    case 'in-progress': return '#ff9800';
                    case 'completed': return '#4caf50';
                    case 'open': return '#ff9800';
                    case 'closed': return '#4caf50';
                    default: return '#666';
                }
            }
            
            editAddress(addressId) {
                this.showAlert('Edit address feature coming soon', 'info');
            }
        }

        // Initialize dashboard when DOM is loaded
        document.addEventListener('DOMContentLoaded', async () => {
            window.dashboard = new DashboardApp();
            
            // Global helper function for mobile menu
            window.closeMobileMenu = function() {
                document.getElementById('mobile-menu-panel').classList.remove('active');
            };
            
            // Global refresh session function
            window.refreshSession = async function() {
                if (window.dashboard) {
                    const refreshed = await window.dashboard.refreshSession();
                    if (!refreshed) {
                        window.dashboard.showAlert('Failed to refresh session', 'error');
                    }
                }
            };
        });

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');
            if (tabParam && window.dashboard && window.dashboard.isValidTab(tabParam)) {
                window.dashboard.switchTab(tabParam);
            }
        });
    </script>
</body>
</html>